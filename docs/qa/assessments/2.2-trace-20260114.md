# Requirements Traceability Matrix

## Story: 2.2 - Aceptar invite + registro + login (solo invitaci√≥n)

### Coverage Summary

- Total ACs: 10
- Fully Covered: 10 (100%)
- Partially Covered: 0
- Not Covered: 0

### Requirement Mappings

#### AC1: Validate invite token (public)

- **Integration Test**: `apps/server/test/auth_http_test.gleam::validate_invite_link_returns_email_when_active_test`
  - Given: An active invite-link token bound to an email
  - When: Calling `GET /api/v1/auth/invite-links/:token`
  - Then: Returns `200` with `{ data: { email } }`

#### AC2: Reject invalid/used tokens

- **Integration Test**: `apps/server/test/auth_http_test.gleam::validate_invite_link_rejects_missing_invalidated_and_used_test`
  - Given: Missing, invalidated, and used tokens
  - When: Calling `GET /api/v1/auth/invite-links/:token`
  - Then: Returns `403` with `INVITE_INVALID` or `INVITE_USED`

#### AC3: Invite-only registration via token

- **Integration Test**: `apps/server/test/auth_http_test.gleam::register_after_bootstrap_requires_invite_test`
  - Given: Org already bootstrapped
  - When: Calling `POST /api/v1/auth/register` without `invite_token`
  - Then: Returns `403 INVITE_REQUIRED`

- **Integration Test**: `apps/server/test/auth_http_test.gleam::register_consumes_invite_once_test`
  - Given: Active invite-link token
  - When: Registering with `{ password, invite_token }`
  - Then: Succeeds and email is derived server-side

#### AC4: Consume token on successful registration

- **Integration Test**: `apps/server/test/auth_http_test.gleam::register_consumes_invite_once_test`
  - Given: A single invite-link token
  - When: Registering twice with the same token
  - Then: First succeeds, second returns `403 INVITE_USED`

#### AC5: Successful register logs in (cookies)

- **Integration Test**: `apps/server/test/auth_http_test.gleam::register_sets_session_and_csrf_cookies_test`
  - Given: Successful registration
  - When: Response is returned
  - Then: `sb_session` and `sb_csrf` cookies are set with expected attributes

#### AC6: Accept-invite UI exists

- **Unit Test**: `apps/client/test/accept_invite_test.gleam::init_with_token_triggers_validation_test`

#### AC7: Accept-invite UX states

- **Unit Test**: `apps/client/test/accept_invite_test.gleam::token_validation_success_moves_to_ready_test`
- **Unit Test**: `apps/client/test/accept_invite_test.gleam::token_validation_failure_moves_to_invalid_test`
- **Unit Test**: `apps/client/test/accept_invite_test.gleam::registration_success_emits_authed_action_test`

#### AC8: Login remains available

- **Integration Test**: `apps/server/test/auth_http_test.gleam::login_sets_session_and_csrf_cookies_test`

#### AC9: Password policy (minimum 12)

- **Integration Test**: `apps/server/test/auth_http_test.gleam::register_rejects_short_password_test`
  - Given: Active invite-link token
  - When: Register with password shorter than 12
  - Then: Returns `422 VALIDATION_ERROR`

#### AC10: No SMTP/email integration

- **Static check**: No SMTP/SendGrid/Mailgun/Nodemailer references in repo for this flow.

Trace matrix: docs/qa/assessments/2.2-trace-20260114.md
