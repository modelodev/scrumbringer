# Requirements Traceability Matrix

## Story: 2.3 - Org Settings (roles admin/member + guardrail last admin)

### Coverage Summary

- Total ACs: 6
- Fully Covered: 6 (100%)
- Partially Covered: 0
- Not Covered: 0

### Requirement Mappings

#### AC1: Org settings UI

- **UI/Integration (manual)**: Admin nav includes "Org Settings" section for org admins.
- **Unit Test (permissions)**: `apps/client/test/permissions_test.gleam::visible_sections_org_admin_test`

#### AC2: List org users for settings

- **API reuse**: `GET /api/v1/org/users`
- **Server tests**: `apps/server/test/org_users_http_test.gleam::org_users_sorted_search_and_empty_test`

#### AC3: Update org role endpoint

- **Integration Test**: `apps/server/test/org_users_http_test.gleam::patch_org_user_role_requires_org_admin_test`
  - Given: org admin + CSRF cookies
  - When: PATCH user role
  - Then: 200 and updated user payload

#### AC4: Guardrail cannot demote last org admin

- **Integration Test**: `apps/server/test/org_users_http_test.gleam::patch_org_user_role_rejects_demoting_last_org_admin_test`
  - Given: single org admin
  - When: attempt to demote self to member
  - Then: 409 `CONFLICT_LAST_ORG_ADMIN`

#### AC5: UI handles guardrail

- **UI behavior (manual)**: Save action stays usable; inline error shown on 409.

#### AC6: Authorization respected

- **Client gating**: `apps/client/test/permissions_test.gleam::visible_sections_project_admin_only_test` (no OrgSettings)
- **Server**: `apps/server/test/org_users_http_test.gleam::patch_org_user_role_requires_org_admin_test` (non-admin gets 403)

Trace matrix: docs/qa/assessments/2.3-trace-20260114.md
