# Requirements Traceability Matrix

## Story: 2.8 - Now Working (estado personal + cronómetro + UX mobile sin Pool)

### Coverage Summary

- Total Requirements (ACs): 11
- Fully Covered: 6
- Partially Covered: 5
- Not Covered: 0

## Requirement Mappings

### AC1: Estado personal, no global

**Coverage: PARTIAL**

- **Integration Test**: `apps/server/test/tasks_http_test.gleam::me_active_task_start_pause_and_persist_test`
  - Given: A claimed task
  - When: Active-task `start` is called
  - Then: Active state is returned via `/api/v1/me/active-task`
  - Coverage: integration

_Gap_: No explicit assertion that `tasks.status` is unchanged by start/pause.

### AC2: Una tarea activa global (0..1)

**Coverage: FULL**

- **Integration Test**: `apps/server/test/tasks_http_test.gleam::me_active_task_replaces_previous_on_start_test`
  - Given: Two claimed tasks
  - When: Start task A then start task B
  - Then: Only task B remains active
  - Coverage: integration

### AC3: Persistencia en servidor

**Coverage: FULL**

- **Integration Test**: `apps/server/test/tasks_http_test.gleam::me_active_task_start_pause_and_persist_test`
  - Given: Active task started
  - When: GET `/api/v1/me/active-task`
  - Then: Active task is returned (server persisted)
  - Coverage: integration

### AC4: Start / Pause (semántica simple)

**Coverage: FULL**

- **Integration Test**: `apps/server/test/tasks_http_test.gleam::me_active_task_start_pause_and_persist_test`
  - Given: Claimed task
  - When: start then pause
  - Then: Active task becomes null
  - Coverage: integration

### AC5: Reemplazo al cambiar

**Coverage: FULL**

- **Integration Test**: `apps/server/test/tasks_http_test.gleam::me_active_task_replaces_previous_on_start_test`
  - Given: Two claimed tasks
  - When: Start another task
  - Then: Previous task is no longer active
  - Coverage: integration

### AC6: Cambio de proyecto limpia active

**Coverage: PARTIAL**

- **Code Path**: `apps/client/src/scrumbringer_client.gleam` pauses on project change.

_Gap_: No automated test found that asserts `pause` is called (or that active_task is cleared) when the user changes project.

### AC7: Integración con Release/Complete

**Coverage: FULL**

- **Integration Test**: `apps/server/test/tasks_http_test.gleam::me_active_task_clears_before_release_and_complete_test`
  - Given: A task is active and claimed
  - When: Release or complete is performed
  - Then: Active task is cleared first
  - Coverage: integration

### AC8: UI Desktop mínima (panel + cronómetro + acciones)

**Coverage: PARTIAL**

- **Code Path**: `apps/client/src/scrumbringer_client.gleam::view_now_working_panel` (title, timer, pause/complete/release).

_Gap_: No UI-level automated assertions; timer uses client clock rather than server `as_of` baseline.

### AC9: UX Mobile específica (sin Pool + redirect /app/pool)

**Coverage: PARTIAL**

- **Unit Test**: `apps/client/test/router_test.gleam::mobile_redirects_pool_to_my_bar_test`
  - Given: Mobile flag enabled
  - When: parsing `/app/pool`
  - Then: redirect to `/app/my-bar`
  - Coverage: unit

_Gap_: No assertion that Pool nav entry is hidden in mobile mode.

### AC10: API nueva (contrato mínimo)

**Coverage: PARTIAL**

- **Integration Tests**: `apps/server/test/tasks_http_test.gleam` helpers exercise:
  - `GET /api/v1/me/active-task`
  - `POST /api/v1/me/active-task/start`
  - `POST /api/v1/me/active-task/pause`
  - `409 CONFLICT_CLAIMED` when not claimed

_Gap_: Tests validate `task_id` presence/nullability; they don’t assert `as_of` exists and is ISO8601.

### AC11: Tests

**Coverage: FULL**

- **Server**: `apps/server/test/tasks_http_test.gleam` new coverage for start/pause/replacement/409/release+complete.
- **Client**: `apps/client/test/api_decode_active_task_test.gleam` and `apps/client/test/router_test.gleam` additions.

## Coverage Gaps (Actionable)

1. **AC6**: Add a test that project change triggers `pause` (or equivalent state clear).
2. **AC8/AC10**: Add a small unit test for timer baseline math using server `as_of` and ensure `as_of` is present in responses.

Trace matrix: docs/qa/assessments/2.8-trace-20260115.md
