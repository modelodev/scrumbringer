# Requirements Traceability Matrix

## Story: 2.7 - Client routing + deep links

### Coverage Summary

- Total ACs: 10
- Fully Covered (automated): 4
- Partially Covered: 3
- Not Covered (automated): 3

### AC Mapping

#### AC1: Deep links funcionan con F5
- Coverage: PARTIAL
  - Given: A canonical pathname URL like `/admin/members?project=2`
  - When: The app initializes
  - Then: It parses pathname+search into a typed Route
- Evidence: `apps/client/src/scrumbringer_client.gleam` init + `router.parse`.
- Gap: No automated browser refresh test.

#### AC2: Caddy SPA fallback
- Coverage: PARTIAL
  - Given: A deep link under `/admin/*` or `/app/*`
  - When: Request hits Caddy
  - Then: It serves `index.html` (SPA fallback) and proxies `/api/v1/*`
- Evidence: `Caddyfile.example`.
- Gap: No automated smoke test.

#### AC3: URL como fuente de verdad
- Coverage: FULL
- Evidence: `apps/client/src/scrumbringer_client/router.gleam`, `apps/client/src/scrumbringer_client.gleam` init/UrlChanged.
- Tests: `apps/client/test/router_test.gleam`.

#### AC4: History API push/replace
- Coverage: PARTIAL
- Evidence: `write_url(Push|Replace, ...)`.
- Gap: No automated browser navigation test.

#### AC5: Back/Forward (popstate)
- Coverage: PARTIAL
- Evidence: `register_popstate` FFI + `UrlChanged` handler.
- Gap: No automated browser navigation test.

#### AC6: Sin duplicar fetches
- Coverage: PARTIAL
- Evidence: hydration checks for Loading/Loaded; project existence guard before members/task-types fetch.
- Gap: No test asserting absence of duplicated network calls.

#### AC7: Hydration determinista (planner puro)
- Coverage: FULL
- Evidence: `apps/client/src/scrumbringer_client/hydration.gleam`.
- Tests: `apps/client/test/hydration_test.gleam`.

#### AC8: Permisos coherentes
- Coverage: FULL
- Evidence: hydration redirects non-admin from `/admin/*` to member routes.
- Tests: `apps/client/test/hydration_test.gleam`.

#### AC9: Compatibilidad accept-invite/reset-password
- Coverage: FULL
- Evidence: `router.parse` + apply_route_fields for those pages.
- Tests: `apps/client/test/router_test.gleam`.

#### AC10: Tests unitarios
- Coverage: FULL
- Evidence: router + hydration unit tests exist and pass.

### Coverage Gaps (Actionable)

- Add a minimal browser-level smoke test (manual or automated) for AC1/2/4/5.
