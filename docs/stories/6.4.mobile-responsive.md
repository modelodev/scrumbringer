# Story 6.4: Mobile Polish y Testing Responsive

## Status

Done

## Story

**As a** usuario de ScrumBringer en dispositivo móvil o tablet,
**I want** que la experiencia móvil sea consistente y todos los elementos sean fácilmente accesibles,
**so that** pueda usar la aplicación cómodamente desde cualquier dispositivo.

## Problem Statement

La auditoría UI (Score: 68/100, Mobile: 45/100) identificó oportunidades de mejora en móvil.

**IMPORTANTE - Infraestructura responsive que YA EXISTE:**

El proyecto YA tiene implementado un sistema responsive completo:

1. **`MobileDrawerState`** en `client_state.gleam`:
   - ADT: `{DrawerClosed, DrawerLeftOpen, DrawerRightOpen}`
   - Helpers: `toggle_left_drawer()`, `toggle_right_drawer()`, `close_drawers()`

2. **`responsive_drawer.gleam`** en `features/layout/`:
   - `DrawerPosition {Left, Right}`
   - `view(is_open, position, on_close, content)` con overlay y aria-modal

3. **`three_panel_layout.gleam`** en `features/layout/`:
   - LayoutConfig con semantic HTML (nav, main, aside)
   - ARIA landmarks
   - Builder pattern idiomático

4. **`view_mobile_shell()`** en `client_view.gleam`:
   - Mobile header
   - Mini task bar
   - Left/right drawers integrados

5. **CSS breakpoints** en `styles.gleam`:
   - `.mobile-header { display: none; } @media (max-width: 768px) { display: flex; }`
   - Media queries para responsive

Esta historia se enfoca en **POLISH y TESTING**, NO en crear nueva infraestructura.

---

## Acceptance Criteria

1. Todos los botones e iconos interactivos en móvil tienen área táctil mínima de 44x44px.
2. Los breakpoints están documentados y son consistentes: sm(640px), md(768px), lg(1024px).
3. La navegación es funcional en viewport 375px (iPhone SE).
4. La transición de layout funciona correctamente en viewport 768px (iPad).
5. No hay overflow horizontal en ningún viewport probado.
6. Los drawers se cierran correctamente al navegar a otra vista.
7. Existe documentación del sistema responsive en `docs/architecture/`.

---

## Tasks / Subtasks

- [x] **Task 1: Auditar touch targets en móvil** (AC: 1)
  - [x] 1.1 Revisar todos los botones de acción en tablas (editar, eliminar).
  - [x] 1.2 Revisar botones en drawers móviles.
  - [x] 1.3 Revisar selectores y dropdowns.
  - [x] 1.4 Ajustar CSS donde min-width/min-height < 44px.
  - [x] 1.5 Documentar elementos ajustados.

- [x] **Task 2: Verificar consistencia de breakpoints** (AC: 2)
  - [x] 2.1 Auditar `styles.gleam` para media queries existentes.
  - [x] 2.2 Verificar que todas usan breakpoints consistentes (640/768/1024).
  - [x] 2.3 Corregir cualquier breakpoint inconsistente.
  - [x] 2.4 Añadir comentarios documentando los breakpoints en CSS.

- [x] **Task 3: Testing E2E viewport 375px (iPhone SE)** (AC: 3, 5)
  - [x] 3.1 Crear script Playwright con viewport 375x667.
  - [x] 3.2 Probar login y navegación a Pool.
  - [x] 3.3 Probar apertura/cierre de drawer izquierdo.
  - [x] 3.4 Probar apertura/cierre de drawer derecho.
  - [x] 3.5 Verificar que no hay scroll horizontal.
  - [x] 3.6 Tomar screenshots de evidencia.

- [x] **Task 4: Testing E2E viewport 768px (iPad)** (AC: 4, 5)
  - [x] 4.1 Crear script Playwright con viewport 768x1024.
  - [x] 4.2 Probar transición de layout (¿desktop o mobile?).
  - [x] 4.3 Verificar comportamiento de paneles.
  - [x] 4.4 Verificar que no hay scroll horizontal.
  - [x] 4.5 Tomar screenshots de evidencia.

- [x] **Task 5: Verificar cierre de drawer al navegar** (AC: 6)
  - [x] 5.1 Revisar handlers de NavigateTo en `client_update_dispatch.gleam`.
  - [x] 5.2 Verificar que MobileDrawersClosed se emite al cambiar de ruta.
  - [x] 5.3 Si no existe, añadir lógica para cerrar drawers al navegar.
  - [x] 5.4 Test: verificar que drawer se cierra al hacer click en nav item.

- [x] **Task 6: Documentar sistema responsive** (AC: 7)
  - [x] 6.1 Crear o actualizar `docs/architecture/responsive.md`.
  - [x] 6.2 Documentar componentes: MobileDrawerState, responsive_drawer, three_panel_layout.
  - [x] 6.3 Documentar breakpoints y comportamiento en cada rango.
  - [x] 6.4 Incluir diagrama de flujo para mobile vs desktop.

---

## Dev Notes

### Infraestructura existente - NO MODIFICAR (salvo bugs)

```
apps/client/src/scrumbringer_client/
├── client_state.gleam                    # MobileDrawerState ADT
├── client_view.gleam                     # view_mobile_shell(), drawers
├── features/layout/
│   ├── responsive_drawer.gleam           # Drawer component
│   └── three_panel_layout.gleam          # 3-panel desktop layout
└── styles.gleam                          # Media queries existentes
```

### Archivos que podrían necesitar ajustes CSS

```
apps/client/src/scrumbringer_client/styles.gleam
- Verificar touch targets
- Verificar breakpoints consistentes
```

### Breakpoints de referencia

```css
/* Definición estándar */
@media (max-width: 640px)  { /* sm: móvil pequeño */ }
@media (max-width: 768px)  { /* md: móvil/tablet */ }
@media (max-width: 1024px) { /* lg: tablet/desktop pequeño */ }

/* Patrón mobile-first existente */
.mobile-header { display: none; }
@media (max-width: 768px) {
  .mobile-header { display: flex; }
  .three-panel-layout { display: block; }
}
```

### Scripts de Playwright para testing

```javascript
// /tmp/test-mobile-375.js
const { chromium } = require('playwright');

(async () => {
  const browser = await chromium.launch({ headless: true });
  const context = await browser.newContext({
    viewport: { width: 375, height: 667 }
  });
  const page = await context.newPage();
  
  // Login
  await page.goto('http://localhost:8080/login');
  await page.fill('input[type="email"]', 'admin@example.com');
  await page.fill('input[type="password"]', 'passwordpassword');
  await page.click('button[type="submit"]');
  await page.waitForTimeout(2000);
  
  // Screenshot pool view
  await page.screenshot({ path: '/tmp/mobile-375-pool.png' });
  
  // Test drawer
  await page.click('[data-testid="mobile-menu-button"]');
  await page.waitForTimeout(500);
  await page.screenshot({ path: '/tmp/mobile-375-drawer.png' });
  
  // Verificar no horizontal scroll
  const hasHScroll = await page.evaluate(() => 
    document.documentElement.scrollWidth > document.documentElement.clientWidth
  );
  console.log('Has horizontal scroll:', hasHScroll);
  
  await browser.close();
})();
```

### Patrón de cierre de drawer al navegar

```gleam
// En client_update_dispatch.gleam, handler de NavigateTo
NavigateTo(route, mode) -> {
  // Cerrar drawers móviles al navegar
  let model = client_state.update_ui(model, fn(ui) {
    UiModel(..ui, mobile_drawer: client_state.DrawerClosed)
  })
  // ... resto del handler de navegación
}
```

---

## Testing

### ⚠️ METODOLOGÍA: TDD OBLIGATORIO

**Proceso para cada Task:**
1. PRIMERO escribir los tests (RED)
2. Ejecutar tests y verificar que fallan
3. Implementar el código mínimo para pasar (GREEN)
4. Refactorizar si es necesario (REFACTOR)
5. Repetir para siguiente subtask

### Test Standards

- **Unit tests**: `apps/client/test/` con gleeunit
- **E2E tests**: Playwright con viewports específicos
- Screenshots como evidencia de regresión visual
- Viewports: 375x667 (iPhone SE), 768x1024 (iPad)

### Test Files

```
apps/client/test/
├── responsive_drawer_test.gleam    # Unit tests para drawer component
├── mobile_drawer_state_test.gleam  # Unit tests para estado
└── three_panel_layout_test.gleam   # Ya existe - verificar no regresión

/tmp/
├── test-mobile-375.js              # E2E Playwright iPhone SE
├── test-tablet-768.js              # E2E Playwright iPad
└── test-drawer-navigation.js       # E2E cierre de drawer al navegar
```

### Unit Test Cases - Archivo: `responsive_drawer_test.gleam`

**NOTA**: La API real de `responsive_drawer.view` es:
```gleam
pub fn view(is_open: Bool, position: DrawerPosition, on_close: msg, content: Element(msg)) -> Element(msg)
```
El drawer SIEMPRE renderiza (con clase `drawer-open` o sin ella), la diferencia es el CSS que lo oculta.

**Happy Path:**
```gleam
pub fn drawer_closed_has_no_open_class_test() {
  let rendered = responsive_drawer.view(
    False,  // is_open
    responsive_drawer.Left,
    NoOp,
    text("Content"),
  )
  let html = element.to_document_string(rendered)
  // Drawer cerrado NO tiene clase drawer-open
  string.contains(html, "drawer-open") |> should.be_false
  // Pero sí tiene la estructura base
  string.contains(html, "drawer-overlay") |> should.be_true
}

pub fn drawer_open_has_open_class_test() {
  let rendered = responsive_drawer.view(
    True,  // is_open
    responsive_drawer.Left,
    NoOp,
    text("Menu Content"),
  )
  let html = element.to_document_string(rendered)
  string.contains(html, "drawer-open") |> should.be_true
  string.contains(html, "Menu Content") |> should.be_true
}

pub fn drawer_has_overlay_always_test() {
  // El overlay existe siempre (CSS lo oculta cuando no está abierto)
  let rendered = responsive_drawer.view(
    False,
    responsive_drawer.Left,
    NoOp,
    text("Content"),
  )
  let html = element.to_document_string(rendered)
  string.contains(html, "drawer-overlay") |> should.be_true
}
```

**Casos Comunes:**
```gleam
pub fn drawer_left_has_left_class_test() {
  let rendered = responsive_drawer.view(
    True,
    responsive_drawer.Left,
    NoOp,
    element.none(),
  )
  let html = element.to_document_string(rendered)
  string.contains(html, "drawer-left") |> should.be_true
}

pub fn drawer_right_has_right_class_test() {
  let rendered = responsive_drawer.view(
    True,
    responsive_drawer.Right,
    NoOp,
    element.none(),
  )
  let html = element.to_document_string(rendered)
  string.contains(html, "drawer-right") |> should.be_true
}

pub fn drawer_has_aria_modal_test() {
  let rendered = responsive_drawer.view(True, responsive_drawer.Left, NoOp, element.none())
  let html = element.to_document_string(rendered)
  string.contains(html, "aria-modal=\"true\"") |> should.be_true
}

pub fn drawer_has_role_dialog_test() {
  let rendered = responsive_drawer.view(True, responsive_drawer.Left, NoOp, element.none())
  let html = element.to_document_string(rendered)
  string.contains(html, "role=\"dialog\"") |> should.be_true
}

pub fn drawer_has_close_button_test() {
  let rendered = responsive_drawer.view(True, responsive_drawer.Left, NoOp, element.none())
  let html = element.to_document_string(rendered)
  string.contains(html, "drawer-close") |> should.be_true
}

pub fn drawer_has_testid_test() {
  let rendered = responsive_drawer.view(True, responsive_drawer.Left, NoOp, element.none())
  let html = element.to_document_string(rendered)
  string.contains(html, "left-drawer") |> should.be_true
}
```

**Casos Edge/Esporádicos:**
```gleam
pub fn drawer_with_element_none_content_renders_test() {
  // Drawer con element.none() como contenido no crashea
  let rendered = responsive_drawer.view(True, responsive_drawer.Left, NoOp, element.none())
  let html = element.to_document_string(rendered)
  string.contains(html, "drawer-content") |> should.be_true
}

pub fn drawer_positions_are_exhaustive_test() {
  // Verificar que solo hay Left y Right
  let positions = [responsive_drawer.Left, responsive_drawer.Right]
  list.length(positions) |> should.equal(2)
}

pub fn drawer_left_and_right_have_different_testids_test() {
  let left = responsive_drawer.view(True, responsive_drawer.Left, NoOp, element.none())
  let right = responsive_drawer.view(True, responsive_drawer.Right, NoOp, element.none())
  let html_left = element.to_document_string(left)
  let html_right = element.to_document_string(right)
  
  string.contains(html_left, "left-drawer") |> should.be_true
  string.contains(html_right, "right-drawer") |> should.be_true
}
```

### Unit Test Cases - Archivo: `mobile_drawer_state_test.gleam`

**Happy Path:**
```gleam
pub fn toggle_left_drawer_opens_when_closed_test() {
  let state = client_state.DrawerClosed
  let new_state = client_state.toggle_left_drawer(state)
  new_state |> should.equal(client_state.DrawerLeftOpen)
}

pub fn toggle_left_drawer_closes_when_open_test() {
  let state = client_state.DrawerLeftOpen
  let new_state = client_state.toggle_left_drawer(state)
  new_state |> should.equal(client_state.DrawerClosed)
}

pub fn toggle_right_drawer_opens_when_closed_test() {
  let state = client_state.DrawerClosed
  let new_state = client_state.toggle_right_drawer(state)
  new_state |> should.equal(client_state.DrawerRightOpen)
}

pub fn close_drawers_closes_left_test() {
  let state = client_state.DrawerLeftOpen
  let new_state = client_state.close_drawers(state)
  new_state |> should.equal(client_state.DrawerClosed)
}

pub fn close_drawers_closes_right_test() {
  let state = client_state.DrawerRightOpen
  let new_state = client_state.close_drawers(state)
  new_state |> should.equal(client_state.DrawerClosed)
}
```

**Casos Comunes:**
```gleam
pub fn toggle_left_closes_right_first_test() {
  // Si el drawer derecho está abierto, toggle left lo cierra y abre left
  let state = client_state.DrawerRightOpen
  let new_state = client_state.toggle_left_drawer(state)
  new_state |> should.equal(client_state.DrawerLeftOpen)
}

pub fn toggle_right_closes_left_first_test() {
  // Si el drawer izquierdo está abierto, toggle right lo cierra y abre right
  let state = client_state.DrawerLeftOpen
  let new_state = client_state.toggle_right_drawer(state)
  new_state |> should.equal(client_state.DrawerRightOpen)
}
```

**Casos Edge:**
```gleam
pub fn close_drawers_on_already_closed_is_idempotent_test() {
  let state = client_state.DrawerClosed
  let new_state = client_state.close_drawers(state)
  new_state |> should.equal(client_state.DrawerClosed)
}

pub fn drawer_state_enum_is_exhaustive_test() {
  // Verificar las 3 variantes del ADT
  let states = [
    client_state.DrawerClosed,
    client_state.DrawerLeftOpen,
    client_state.DrawerRightOpen,
  ]
  list.length(states) |> should.equal(3)
}
```

### E2E Test Cases - Playwright Scripts

#### Test iPhone SE (375x667) - `/tmp/test-mobile-375.js`

```javascript
const { chromium } = require('playwright');
const assert = require('assert');

const TARGET_URL = 'http://localhost:8080';

(async () => {
  console.log('=== Mobile 375px Tests ===\n');
  
  const browser = await chromium.launch({ headless: true });
  const context = await browser.newContext({
    viewport: { width: 375, height: 667 }
  });
  const page = await context.newPage();
  
  // === Setup: Login ===
  await page.goto(TARGET_URL + '/login');
  await page.fill('input[type="email"]', 'admin@example.com');
  await page.fill('input[type="password"]', 'passwordpassword');
  await page.click('button[type="submit"]');
  await page.waitForTimeout(3000);
  
  // === Test 1: Mobile header visible ===
  console.log('Test 1: Mobile header visible');
  const mobileHeader = await page.$('.mobile-header');
  assert(mobileHeader !== null, 'Mobile header should be visible at 375px');
  await page.screenshot({ path: '/tmp/mobile-375-header.png' });
  console.log('  ✓ Mobile header is visible\n');
  
  // === Test 2: No horizontal scroll ===
  console.log('Test 2: No horizontal scroll');
  const hasHScroll = await page.evaluate(() => 
    document.documentElement.scrollWidth > document.documentElement.clientWidth
  );
  assert(!hasHScroll, 'Should not have horizontal scroll at 375px');
  console.log('  ✓ No horizontal scroll\n');
  
  // === Test 3: Drawer opens on hamburger click ===
  console.log('Test 3: Left drawer opens');
  const hamburger = await page.$('[data-testid="mobile-menu-button"], .mobile-menu-btn');
  if (hamburger) {
    await hamburger.click();
    await page.waitForTimeout(500);
    const drawer = await page.$('.drawer-left, .responsive-drawer');
    assert(drawer !== null, 'Drawer should open on hamburger click');
    await page.screenshot({ path: '/tmp/mobile-375-drawer-open.png' });
    console.log('  ✓ Drawer opens correctly\n');
    
    // === Test 4: Drawer closes on overlay click ===
    console.log('Test 4: Drawer closes on overlay');
    const overlay = await page.$('.drawer-overlay');
    if (overlay) {
      await overlay.click();
      await page.waitForTimeout(500);
      const drawerAfter = await page.$('.drawer-left.open, .responsive-drawer.open');
      // Drawer should be closed (not visible or no open class)
      await page.screenshot({ path: '/tmp/mobile-375-drawer-closed.png' });
      console.log('  ✓ Drawer closes on overlay click\n');
    }
  } else {
    console.log('  ⚠ Hamburger button not found (may need different selector)\n');
  }
  
  // === Test 5: Touch targets >= 44px ===
  console.log('Test 5: Touch targets size');
  const actionButtons = await page.$$('.btn-icon, .action-btn, [class*="icon-button"]');
  let smallButtons = 0;
  for (const btn of actionButtons) {
    const box = await btn.boundingBox();
    if (box && (box.width < 44 || box.height < 44)) {
      smallButtons++;
      console.log(`  ⚠ Small button: ${box.width}x${box.height}px`);
    }
  }
  if (smallButtons === 0) {
    console.log('  ✓ All touch targets >= 44px\n');
  } else {
    console.log(`  ✗ ${smallButtons} buttons smaller than 44px\n`);
  }
  
  // === Test 6: Text not truncated ===
  console.log('Test 6: Content fits viewport');
  await page.screenshot({ path: '/tmp/mobile-375-final.png', fullPage: true });
  console.log('  ✓ Full page screenshot saved\n');
  
  await browser.close();
  console.log('=== Mobile 375px Tests Complete ===');
})();
```

#### Test iPad (768x1024) - `/tmp/test-tablet-768.js`

```javascript
const { chromium } = require('playwright');
const assert = require('assert');

const TARGET_URL = 'http://localhost:8080';

(async () => {
  console.log('=== Tablet 768px Tests ===\n');
  
  const browser = await chromium.launch({ headless: true });
  const context = await browser.newContext({
    viewport: { width: 768, height: 1024 }
  });
  const page = await context.newPage();
  
  // === Setup: Login ===
  await page.goto(TARGET_URL + '/login');
  await page.fill('input[type="email"]', 'admin@example.com');
  await page.fill('input[type="password"]', 'passwordpassword');
  await page.click('button[type="submit"]');
  await page.waitForTimeout(3000);
  
  // === Test 1: Layout transition ===
  console.log('Test 1: Layout at 768px breakpoint');
  await page.screenshot({ path: '/tmp/tablet-768-layout.png' });
  
  // Check if mobile or desktop layout
  const mobileHeader = await page.$('.mobile-header:not([style*="display: none"])');
  const desktopNav = await page.$('.left-panel:not([style*="display: none"]), nav.sidebar');
  
  console.log(`  Mobile header visible: ${mobileHeader !== null}`);
  console.log(`  Desktop nav visible: ${desktopNav !== null}`);
  console.log('  ✓ Layout captured\n');
  
  // === Test 2: No horizontal scroll ===
  console.log('Test 2: No horizontal scroll');
  const hasHScroll = await page.evaluate(() => 
    document.documentElement.scrollWidth > document.documentElement.clientWidth
  );
  assert(!hasHScroll, 'Should not have horizontal scroll at 768px');
  console.log('  ✓ No horizontal scroll\n');
  
  // === Test 3: Three panel layout behavior ===
  console.log('Test 3: Panel layout');
  const panels = await page.$$('.panel, .three-panel-layout > *');
  console.log(`  Found ${panels.length} panels`);
  await page.screenshot({ path: '/tmp/tablet-768-panels.png' });
  console.log('  ✓ Panels captured\n');
  
  // === Test 4: Transition from 768 to 769 ===
  console.log('Test 4: Breakpoint transition');
  await page.setViewportSize({ width: 769, height: 1024 });
  await page.waitForTimeout(300);
  await page.screenshot({ path: '/tmp/tablet-769-above-breakpoint.png' });
  
  await page.setViewportSize({ width: 767, height: 1024 });
  await page.waitForTimeout(300);
  await page.screenshot({ path: '/tmp/tablet-767-below-breakpoint.png' });
  console.log('  ✓ Breakpoint transitions captured\n');
  
  await browser.close();
  console.log('=== Tablet 768px Tests Complete ===');
})();
```

#### Test Drawer Navigation - `/tmp/test-drawer-navigation.js`

```javascript
const { chromium } = require('playwright');
const assert = require('assert');

const TARGET_URL = 'http://localhost:8080';

(async () => {
  console.log('=== Drawer Navigation Tests ===\n');
  
  const browser = await chromium.launch({ headless: true });
  const context = await browser.newContext({
    viewport: { width: 375, height: 667 }
  });
  const page = await context.newPage();
  
  // === Setup: Login ===
  await page.goto(TARGET_URL + '/login');
  await page.fill('input[type="email"]', 'admin@example.com');
  await page.fill('input[type="password"]', 'passwordpassword');
  await page.click('button[type="submit"]');
  await page.waitForTimeout(3000);
  
  // === Test: Drawer closes on navigation ===
  console.log('Test: Drawer closes when navigating');
  
  // Open drawer
  const hamburger = await page.$('[data-testid="mobile-menu-button"], .mobile-menu-btn');
  if (hamburger) {
    await hamburger.click();
    await page.waitForTimeout(500);
    
    // Verify drawer is open
    const drawerOpen = await page.$('.drawer-overlay');
    assert(drawerOpen !== null, 'Drawer should be open');
    console.log('  Drawer opened');
    await page.screenshot({ path: '/tmp/drawer-nav-1-open.png' });
    
    // Click a nav item (e.g., Admin/Settings)
    const navItem = await page.$('nav a[href*="admin"], .nav-item');
    if (navItem) {
      await navItem.click();
      await page.waitForTimeout(1000);
      
      // Verify drawer is closed
      const drawerClosed = await page.$('.drawer-overlay');
      const isHidden = drawerClosed === null || 
        await drawerClosed.evaluate(el => 
          getComputedStyle(el).display === 'none' || 
          !el.classList.contains('open')
        );
      
      await page.screenshot({ path: '/tmp/drawer-nav-2-after-click.png' });
      
      if (isHidden) {
        console.log('  ✓ Drawer closed after navigation\n');
      } else {
        console.log('  ✗ Drawer still open after navigation\n');
      }
    } else {
      console.log('  ⚠ Nav item not found\n');
    }
  } else {
    console.log('  ⚠ Hamburger button not found\n');
  }
  
  await browser.close();
  console.log('=== Drawer Navigation Tests Complete ===');
})();
```

### Checklist de Verificación Visual

- [ ] iPhone SE (375px): Header móvil visible
- [ ] iPhone SE (375px): Sin scroll horizontal
- [ ] iPhone SE (375px): Drawer izquierdo funciona
- [ ] iPhone SE (375px): Drawer derecho funciona
- [ ] iPhone SE (375px): Touch targets ≥44px
- [ ] iPad (768px): Layout correcto (mobile o desktop según diseño)
- [ ] iPad (768px): Sin scroll horizontal
- [ ] iPad (768px): Transición de breakpoint fluida
- [ ] Navegación: Drawer se cierra al cambiar de vista
- [ ] Overlay: Click en overlay cierra drawer

### Nota para QA (post-implementacion)

- Repetir auditoria UI completa (agent-browser + ui-audit) para contrastar contra `capturas/UI-AUDIT-REPORT-v2.md`.

---

## Out of Scope

- Crear nuevo componente MobileDrawer (ya existe responsive_drawer.gleam)
- Crear nuevo componente MobileHeader (ya existe en view_mobile_shell)
- Crear nuevo estado MobileDrawerState (ya existe en client_state.gleam)
- Refactorizar AppShell (ya existe three_panel_layout.gleam)
- PWA / Service Workers
- Gestos de swipe

---

## Change Log

| Fecha | Version | Descripcion | Autor |
|-------|---------|-------------|-------|
| 2026-02-03 | 1.0 | Historia creada desde UI Audit Plan - Fase 3 | PO |
| 2026-02-03 | 2.0 | Reescrita por Arquitecto: enfoque en polish/testing, no nueva infraestructura | Architect |
| 2026-02-03 | 3.0 | Ajustes responsive, tests y documentacion del sistema mobile | dev |

---

## Dev Agent Record

### Agent Model Used

openai/gpt-5.2-codex

### Debug Log References

- `gleam test`
- `node run.js /tmp/test-mobile-375.js`
- `node run.js /tmp/test-tablet-768.js`
- `node run.js /tmp/test-drawer-navigation.js`

### Completion Notes List

- Standardized breakpoints to 640/768/1024 and documented them in CSS and architecture docs.
- Ensured mobile drawer close targets meet 44px and drawers close on navigation.
- Added responsive drawer and mobile drawer state unit tests plus navigation close test.
- Captured Playwright evidence in /tmp screenshots for 375px and 768px flows.

### File List

- apps/client/src/scrumbringer_client/client_update.gleam
- apps/client/src/scrumbringer_client/styles.gleam
- apps/client/test/responsive_drawer_test.gleam
- apps/client/test/mobile_drawer_state_test.gleam
- apps/client/test/mobile_drawer_navigation_test.gleam
- docs/architecture/responsive.md

---

## QA Results

### Review Date: 2026-02-03

### Reviewed By: Quinn (Test Architect)

### UI Audit Results (v3 vs v2 Baseline)

**Overall Score Improvement: 68/100 → 78/100 (+15%)**

| Category | v2 Score | v3 Score | Delta |
|----------|----------|----------|-------|
| Mobile Experience | 45/100 | 80/100 | **+35** |
| Accessibility | 55/100 | 70/100 | +15 |
| Forms & Inputs | 60/100 | 75/100 | +15 |
| Visual Hierarchy | 62/100 | 72/100 | +10 |
| Usability | 70/100 | 78/100 | +8 |
| Visual Style | 70/100 | 75/100 | +5 |
| Navigation | 78/100 | 82/100 | +4 |

### Verification Results

**Automated Checks (Playwright):**
- ✅ No horizontal scroll at 375px viewport
- ✅ No horizontal scroll at 768px viewport
- ✅ Touch targets: 27/28 elements ≥ 44px (1 intentional 1x1px skip-link)
- ✅ Mobile header visible at 375px
- ✅ Layout transitions correctly at breakpoints

**Manual Verification:**
- ✅ Breakpoints documented (640/768/1024px) in styles.gleam and responsive.md
- ✅ Drawer close on navigation implemented in handle_navigate_to()
- ✅ Drawer close button meets 44px touch target

**Screenshots Captured:**
- `/tmp/audit-01-login-desktop.png` through `/tmp/audit-16-focus-state.png`
- Full report: `capturas/UI-AUDIT-REPORT-v3.md`

### Compliance Check

- Coding Standards: ✓
- Project Structure: ✓
- Testing Strategy: ✓
- All ACs Met: ✓

### Gate Status

Gate: PASS → docs/qa/gates/6.4-mobile-responsive.yml

### Recommended Status

✓ Ready for Done

### Review Date: 2026-02-03

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

- Drawer close on navigation verified in `apps/client/src/scrumbringer_client/client_update.gleam` (handle_navigate_to sets DrawerClosed).
- Breakpoints documented in `apps/client/src/scrumbringer_client/styles.gleam` and `docs/architecture/responsive.md`.
- Touch target minimums enforced for action buttons in `styles.gleam`; UI audit v3 confirms visible targets meet 44px.

### Evidence Reviewed

- UI audit report v3: `capturas/UI-AUDIT-REPORT-v3.md` (overall 78/100, Mobile 80/100, no horizontal scroll).
- Unit tests reviewed: `apps/client/test/responsive_drawer_test.gleam`, `apps/client/test/mobile_drawer_state_test.gleam`, `apps/client/test/mobile_drawer_navigation_test.gleam`.

### Refactoring Performed

- None.

### Compliance Check

- Coding Standards: ✓
- Project Structure: ✓
- Testing Strategy: ✓ (tests reviewed; not re-run in this QA pass)
- All ACs Met: ✓

### Improvements Checklist

- [ ] Follow up on remaining UI audit items (contrast gray-500, kanban status icons, breadcrumbs).

### Security Review

- No security-sensitive changes in this story.

### Performance Considerations

- CSS-only changes; no regressions observed.

### Files Modified During Review

- None.

### Gate Status

Gate: PASS → docs/qa/gates/6.4-mobile-responsive.yml

### Recommended Status

✓ Ready for Done
