# Story 7.9: Homogeneizacion UX de Hitos y creacion sin modales anidados

## Status

Draft

## Story

**As a** manager/admin del proyecto,
**I want** que la vista de Hitos use la misma jerarquia visual y patron de acciones que el resto de la app, y que la creacion contextual no anide modales,
**so that** la experiencia sea consistente, mas clara y mas eficiente para crear y gestionar trabajo por hitos.

## Contexto UX

Hallazgos sobre `capturas/vista_hitos.png` y patrones actuales de detalle:

1. Acciones de hito inconsistentes con otras vistas (uso de `...` para una sola accion).
2. Jerarquia confusa entre acciones de navegacion (`Ver detalle`), workflow (`Activar`) y gestion (`Editar`, `Eliminar`).
3. Progreso de hito expresado distinto segun vista (conteos en hito vs barra en card/sidebar).
4. Existen flujos con modal sobre modal (notes en detalle card/task), y riesgo de replicar ese anti-patron en creacion contextual.

## Objetivo UX

1. Unificar la semantica de acciones en filas de hitos (navegacion, workflow, gestion).
2. Unificar representacion de progreso para reducir carga cognitiva.
3. Mantener reutilizacion maxima de componentes y flujos existentes.
4. Eliminar anidacion modal en flujo de crear desde hito, habilitando creacion repetida eficiente.

## Scope

**Incluye:**

1. Reorganizacion de acciones en fila de hito:
   - `Ver detalle` como accion principal de navegacion.
   - `Activar` como accion de estado separada.
   - `Editar` y `Eliminar` como iconos inline (lapiz/papelera), eliminando `...` cuando solo hay esa accion.
2. Unificacion de progreso de hito con patron comun:
   - Lista: barra + porcentaje + resumen breve.
   - Detalle: barra + porcentaje + conteos (`cards x/y`, `tasks x/y`).
3. Flujo de crear multiples cards desde contexto de hito sin modales anidados:
   - Reusar `card_crud_dialog` existente.
   - Agregar accion `Guardar y crear otra` (o toggle equivalente) manteniendo `milestone_id` contextual.
   - Cerrar/reemplazar modal origen para evitar stack.
4. Ajustes i18n ES/EN y pruebas de regresion/flujo.

**No incluye:**

1. Redise√±o completo de sistema visual global.
2. Cambios backend de dominio de hitos/cards.
3. Refactor masivo de todos los modales legacy fuera del flujo tocado (se documenta follow-up).

## Acceptance Criteria

1. **AC1**: En fila de hito no se muestra menu `...` cuando solo existe una accion secundaria; `Eliminar` se muestra como icono inline con confirmacion.
2. **AC2**: `Editar` de hito se muestra como icono lapiz inline, consistente con patrones de vistas administrativas.
3. **AC3**: `Ver detalle` se mantiene como accion principal de navegacion, visualmente separada de acciones de gestion.
4. **AC4**: `Activar` se presenta como accion de workflow/estado, sin competir visualmente con `Editar/Eliminar`.
5. **AC5**: La lista de hitos muestra progreso homogeneizado (barra + %), manteniendo acceso a conteos.
6. **AC6**: El detalle de hito muestra progreso con el mismo lenguaje visual que cards (barra + % + conteos), sin representaciones contradictorias.
7. **AC7**: Desde contexto de hito se pueden crear varias cards seguidas sin modal anidado, reutilizando `card_crud_dialog` con opcion `Guardar y crear otra`.
8. **AC8**: En flujo contextual de crear-card, `milestone_id` permanece fijo entre iteraciones cuando el usuario elige crear otra.
9. **AC9**: No se introduce stack de modales en el flujo de creacion contextual desde hito (maximo un modal activo).
10. **AC10**: i18n ES/EN completo para textos nuevos (`Guardar y crear otra`, labels/progreso/acciones).
11. **AC11**: Cobertura de pruebas deterministas para acciones inline, progreso unificado y flujo create-multiple contextual sin stack.
12. **AC12**: Regression: flujos existentes de create card no contextual y detalle de hito permanecen funcionales.

## Reutilizacion / Arquitectura objetivo

1. Reusar `card_crud_dialog` y handlers de `features/admin/cards.gleam` para create contextual.
2. Reusar utilidades de IDs de hitos en `features/milestones/ids.gleam` para foco/targets estables.
3. Reusar componentes compartidos de detalle/progreso ya introducidos (`ui/detail_metrics`, `ui/detail_tabs`, `ui/card_progress` donde aplique).
4. Reusar patrones de botones/iconos de vistas administrativas (`action_buttons` y clases existentes) evitando variantes ad hoc.

## Tasks / Subtasks

- [ ] **Task 1 (AC: 1, 2, 3, 4): Acciones consistentes en fila de hito**
  - [ ] 1.1 Reemplazar menu `...` por iconos inline cuando no haya multiples acciones reales.
  - [ ] 1.2 Mostrar `Editar` (lapiz) y `Eliminar` (papelera) alineados al patron de otras vistas.
  - [ ] 1.3 Mantener `Ver detalle` como accion principal y `Activar` como accion de estado separada.
  - [ ] 1.4 Ajustar foco/teclado/tooltips en iconos de accion.

- [ ] **Task 2 (AC: 5, 6): Progreso unificado en lista y detalle**
  - [ ] 2.1 Lista de hitos: barra + % + resumen corto consistente.
  - [ ] 2.2 Detalle de hito: barra + % + conteos cards/tasks con jerarquia clara.
  - [ ] 2.3 Alinear spacing/typography/chips con detalle de card.

- [ ] **Task 3 (AC: 7, 8, 9): Crear varias cards sin modal anidado**
  - [ ] 3.1 Extender `card_crud_dialog` con accion `Guardar y crear otra` (o toggle equivalente) en modo create.
  - [ ] 3.2 Preservar `milestone_id` contextual al iterar creaciones consecutivas.
  - [ ] 3.3 Garantizar que en cualquier paso hay solo un modal activo (sin stack).
  - [ ] 3.4 Confirmar retorno/foco coherente al cerrar flujo.

- [ ] **Task 4 (AC: 10, 12): i18n y regresion funcional**
  - [ ] 4.1 Agregar claves ES/EN para copy nuevo y labels de progreso unificado.
  - [ ] 4.2 Validar que create card no contextual conserva comportamiento actual.
  - [ ] 4.3 Validar que detalle/acciones de hito no rompen historias 7.6-7.8.

- [ ] **Task 5 (AC: 11): Testing determinista**
  - [ ] 5.1 Test de render de acciones inline (sin `...` cuando no aplica).
  - [ ] 5.2 Test de jerarquia funcional (`Ver detalle`, `Activar`, `Editar`, `Eliminar`).
  - [ ] 5.3 Test de progreso unificado en lista y detalle.
  - [ ] 5.4 Test de flujo `Guardar y crear otra` contextual manteniendo `milestone_id`.
  - [ ] 5.5 Test de no-anidacion modal (solo un dialog activo).

## Testing Notes

- Cliente:
  - `gleam format`
  - `gleam check`
  - `gleam test`
- Suites candidatas:
  - `apps/client/test/milestones_view_test.gleam`
  - `apps/client/test/milestones_update_test.gleam`
  - `apps/client/test/admin_cards_view_test.gleam`
  - `apps/client/test/card_crud_dialog_test.gleam`

## Definition of Done

1. Vista de hitos con jerarquia de acciones consistente con otras vistas.
2. Progreso de hitos y cards con lenguaje visual unificado.
3. Flujo de creacion repetida de cards contextual sin modales anidados.
4. i18n ES/EN completo para nuevos textos.
5. Tests de regresion/flujo en verde.

## Change Log

| Date       | Version | Description                                                                  | Author |
| ---------- | ------- | ---------------------------------------------------------------------------- | ------ |
| 2026-02-08 | 0.1     | Story creada desde feedback UX sobre consistencia de Hitos y no-anidacion   | UX     |

## Dev Agent Record

### Agent Model Used

_Pending implementation._

### Debug Log References

_Pending implementation._

### Completion Notes List

_Pending implementation._

### File List

_Pending implementation._

## QA Results

_Pending QA review._
