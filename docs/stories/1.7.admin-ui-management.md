# Story 1.7: Admin UI (Invites, Projects, Members, Capabilities, Task Types)

## Status
Approved

## Story
**As an** organization admin (and project admin),
**I want** a minimal admin UI to manage invites, projects, members, capabilities and task types,
**so that** I can onboard users and configure projects without direct database access.

## Acceptance Criteria
1. **Login-required**: Admin UI requires authentication; unauthenticated users are redirected to login.
2. **Invite creation**: Org admins can create org invites from the UI (calls `POST /api/v1/org/invites`) and see the generated `invite.code`.
3. **Project creation**: Org admins can create projects (calls `POST /api/v1/projects`).
4. **Org user directory**: Admin UI can search/list org users (calls `GET /api/v1/org/users?q=...`) to find user ids by email.
5. **Project membership management**: Project admins can list/add/remove members for a selected project (calls:
   - `GET /api/v1/projects/:project_id/members`
   - `POST /api/v1/projects/:project_id/members`
   - `DELETE /api/v1/projects/:project_id/members/:user_id`
   ).
6. **Capabilities management**: Org admins can list/create capabilities (calls `GET /api/v1/capabilities`, `POST /api/v1/capabilities`).
7. **Task types management**: Project admins can list/create task types for a selected project (calls `GET /api/v1/projects/:project_id/task-types`, `POST /api/v1/projects/:project_id/task-types`).
8. **Onboarding flow is doable**: A newly-invited user can be added to a project using this UI without needing direct DB access.
9. **Authorization respected (negative)**: UI hides/blocks actions not allowed by the user’s role (e.g., non-org-admin cannot create projects or capabilities).
10. **CSRF for mutations**: All UI-triggered mutating requests include CSRF double-submit (`sb_csrf` + `X-CSRF`).
11. **No pagination (MVP)**: Lists are rendered without pagination in MVP.

## Tasks / Subtasks
- [ ] Implement admin navigation + project selector (AC: 1)
- [ ] Implement invite creation screen (AC: 2, 8)
- [ ] Implement project creation screen (AC: 3, 8)
- [ ] Implement org user directory / search screen (AC: 4)
- [ ] Implement members management screen (AC: 5, 8, 9, 10)
- [ ] Implement capabilities management screen (AC: 5, 7, 8)
- [ ] Implement task types management screen (AC: 6, 7, 8)
- [ ] Add tests for:
  - [ ] rendering gated actions based on role (`my_role`, `org_role`) (AC: 7)
  - [ ] request building includes CSRF on mutating calls (AC: 8)

## Dev Notes
Source of truth:
- MVP features include managing capabilities, task types, projects, and invite-based auth: `docs/brief.md` (see “MVP Scope v1.0”).
- API endpoints and authorization matrix: `docs/architecture/api-contract.md`.
- Roles:
  - Org admin: can create projects, org invites, capabilities.
  - Project admin: can manage project membership and create task types.
  [Source: `docs/architecture/api-contract.md` “Roles” and “Authorization Matrix (MVP)”].

UI scope:
- Keep this UI minimal and functional; visual polish can iterate later.
- Project selection should be client-side state in MVP.

### Testing
- Use `gleeunit` where applicable.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-12 | 1.0 | Initial draft | architect |
| 2026-01-12 | 1.1 | Added org user directory requirement to make membership management usable; aligned AC/tasks to include user search by email | architect |
| 2026-01-12 | 1.2 | Approved for implementation (usability pass: onboarding without DB access) | architect |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
