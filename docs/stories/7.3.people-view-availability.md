# Story 7.3: Vista Personas (disponibilidad por proyecto)

## Status

Draft

## Story

**As a** miembro del proyecto,
**I want** ver rapidamente quien esta trabajando, ocupado o libre,
**so that** pueda coordinar mejor las tareas del proyecto.

## Problem Statement

No existe una vista principal para visualizar disponibilidad por persona. El estado “en curso” solo se ve en el panel derecho, y no hay una forma clara de ver la carga del equipo por proyecto.

---

## Acceptance Criteria

1. Se agrega una vista **Personas** en la seccion TRABAJO (despues de Pool/Lista/Tarjetas).
2. La vista es accesible para todos los miembros del proyecto y lista miembros del proyecto actual.
3. Existe barra de busqueda para filtrar por nombre.
4. Cada persona muestra estado principal con chip sutil: `Trabajando…`, `Ocupado`, `Libre`.
5. Al expandir (triangulito), se muestran:
   - Seccion **Activa** (si existe) con etiqueta clara.
   - Seccion **Reclamadas** con lista compacta.
6. El estado principal sigue estas reglas (derivadas desde tareas del proyecto, no desde estado local de UI):
   - `Trabajando…`: tiene sesion activa.
   - `Ocupado`: tiene tareas reclamadas sin sesion activa.
   - `Libre`: sin sesion activa y sin tareas reclamadas.
7. La navegacion de Personas reutiliza el patron existente de `ViewMode` (Pool/List/Cards) en sidebar y center panel, sin rutas o toggles paralelos (NO crear `/app/people`; usar `router.Member(member_section.Pool, state)` con `view=people`).
8. Los textos de UI (item de navegacion, chips, estados vacios) salen de i18n y la vista es operable por teclado (toggle expand/collapse con foco visible, `button`, `aria-expanded`, `aria-controls`).
9. En `view=people`, la toolbar muestra solo busqueda por nombre; filtros de tipo/capacidad no se renderizan para evitar ruido cognitivo.
10. La vista contempla estados de datos: `loading`, `empty roster`, `sin resultados de busqueda`, y `error de carga`, todos con copy i18n.
11. La lista de personas usa semantica accesible (`ul/li` o `role=list/listitem`) y cada toggle tiene nombre accesible contextual (ej. "Expandir estado de {nombre}").

---

## Tasks / Subtasks

- [ ] **Task 0: Contrato de navegacion y ownership MVU** (AC: 1, 2, 7)
  - [ ] 0.1 Extender `ViewMode` con variante `People` en el dominio compartido.
  - [ ] 0.2 Integrar `People` en `left_panel` y `center_panel` reutilizando el flujo actual de navegacion de vistas de trabajo.
  - [ ] 0.3 Mantener `client_view` como ensamblador y `client_update` como router; logica de feature en `features/people/*`.

- [ ] **Task 1: Navegacion y ruta** (AC: 1, 2)
  - [ ] 1.1 Agregar item “Personas” en TRABAJO.
  - [ ] 1.2 Incluir `ViewMode.People` en parse/format de URL state y router sin crear rutas nuevas.

- [ ] **Task 2: Vista Personas** (AC: 3-6)
  - [ ] 2.1 Construir lista con busqueda.
  - [ ] 2.1.1 En `People`, mostrar solo search en toolbar (sin type/capability filters).
  - [ ] 2.2 Calcular estado principal segun reglas.
  - [ ] 2.3 Implementar expand/collapse con triangulito consistente.
  - [ ] 2.3.1 Definir comportamiento expand/collapse (multi-expand permitido) y persistencia al aplicar busqueda.
  - [ ] 2.4 Render de secciones Activa/Reclamadas.
  - [ ] 2.4.1 Renderizar estados `loading/empty/no-results/error` con componentes/patrones existentes.
  - [ ] 2.5 Fuente de verdad de disponibilidad: derivar por persona desde `member.pool.member_tasks` (`Claimed(Ongoing)` => Working; `Claimed(Taken)` => Busy; ninguno => Free), sin duplicar estado persistente.
  - [ ] 2.6 Definir fuente de roster por proyecto (project_members + org_users/email display label) para busqueda por nombre.

- [ ] **Task 3: Styles y chips sutiles** (AC: 4)
  - [ ] 3.1 Reutilizar `badge` con variantes sutiles de estado.
  - [ ] 3.1.1 Definir mapping visual fijo: `Working -> badge-primary`, `Busy -> badge-warning`, `Free -> badge-success` (evitar `badge-neutral` para estados primarios).
  - [ ] 3.2 Ajustar estilos para filas compactas y legibles.
  - [ ] 3.2.1 Especificar minimos de legibilidad: alto de fila, truncado de nombre, prioridad visual nombre > estado > meta.

- [ ] **Task 4: Tests** (AC: 1-8)
  - [ ] 4.1 Tests de vista para reglas de estado.
  - [ ] 4.2 Tests de expand/collapse.
  - [ ] 4.3 Tests de routing/view mode para entrada a Personas desde TRABAJO (`view=people` parse/format/roundtrip).
  - [ ] 4.4 Tests de i18n y accesibilidad basica (teclado/foco visible en toggle expand/collapse).
  - [ ] 4.5 Tests de a11y del toggle (`aria-expanded`, teclado Enter/Space, foco visible).
  - [ ] 4.6 Tests de estados de datos (`loading`, `empty`, `no-results`, `error`) y copy i18n.
  - [ ] 4.7 Test de toolbar en People: solo busqueda visible (sin filtros de tipo/capacidad).
  - [ ] 4.8 Test de semantica de lista/filas (`ul/li` o roles equivalentes) + nombre accesible del toggle.

---

## Dev Notes

### Archivos clave (frontend)

```
apps/client/src/scrumbringer_client/features/layout/left_panel.gleam
apps/client/src/scrumbringer_client/features/layout/center_panel.gleam
apps/client/src/scrumbringer_client/features/layout/view_mode_toggle.gleam
apps/client/src/scrumbringer_client/router.gleam
shared/src/domain/view_mode.gleam
apps/client/src/scrumbringer_client/features/people/view.gleam (nuevo)
apps/client/src/scrumbringer_client/features/people/state.gleam (nuevo)
apps/client/src/scrumbringer_client/features/people/msg.gleam (nuevo)
apps/client/src/scrumbringer_client/features/people/update.gleam (nuevo)
apps/client/src/scrumbringer_client/styles.gleam
apps/client/src/scrumbringer_client/ui/badge.gleam
apps/client/src/scrumbringer_client/i18n/text.gleam
```

### UX Design

- Sin avatar/iniciales; nombre como elemento principal.
- Chips sutiles (borde + texto) para estado.
- Mapping recomendado de color/jerarquia: Working=Primary, Busy=Warning, Free=Success.
- Expand con triangulito consistente con otras vistas.
- Estados y etiquetas consistentes con el lenguaje actual de la interfaz (sin microcopys ad hoc fuera de i18n).
- Definir nuevas keys i18n minimas: `People`, `Busy`, `Free`, `PeopleSearchPlaceholder`, `PeopleEmpty`, `PeopleNoResults`, `PeopleLoading`, `PeopleLoadError`, `ExpandPerson`, `CollapsePerson`.

### Refactor Alignment (docs/architecture/refactor-plan-detailed.md)

- Nuevo feature completo `features/people/*` (state/msg/update/view).
- `client_view` solo ensambla; `client_update` solo enruta.
- Reutilizar la arquitectura de `ViewMode` existente para evitar rutas paralelas de navegacion en TRABAJO.
- Considerar integracion futura con `url_state` si la busqueda se vuelve compartida.

### Type Notes (gleam-type-system)

- Definir `Availability = Working | Busy | Free` y `PersonStatus` con `Option(Task)` para activa.
- Derivar disponibilidad a partir de estado existente (no duplicar origen de verdad):
  - `Working`: existe al menos una tarea de la persona en `Claimed(Ongoing)`.
  - `Busy`: no hay `Claimed(Ongoing)` y existe al menos una en `Claimed(Taken)`.
  - `Free`: no hay tareas en `Claimed(Ongoing|Taken)` para la persona.
- Mantener pattern matching exhaustivo para `Availability` en `view` y helpers de etiqueta/chip.
- Definir `RowExpansion = Expanded | Collapsed` para expand/collapse (evitar bools crudos).

---

## Testing

- Tests de vista en `apps/client/test`.
- Cobertura AC explicita:
  - AC1/AC2/AC7: navegacion a Personas via `ViewMode` desde TRABAJO.
  - AC3-AC6: reglas de disponibilidad y render Activa/Reclamadas.
  - AC8: textos por i18n + interaccion de expand/collapse por teclado.
  - AC9: toolbar especifica de People (solo search).
  - AC10: estados de datos (`loading/empty/no-results/error`) con copy i18n.
  - AC11: semantica accesible de lista y nombre accesible del toggle.

### TDD (gleam-tdd-development)

- Definir tipos de estado y firmas primero.
- Escribir tests de reglas de estado y expand/collapse antes de implementar.

---

## Out of Scope

- Panel derecho de trabajo en curso.
- Avatares o imagenes de usuario.
- Indicadores avanzados de carga (puntos/porcentaje).

---

## Change Log

| Fecha | Version | Descripcion | Autor |
|-------|---------|-------------|-------|
| 2026-02-05 | 1.0 | Historia creada para sprint 7 | UX/PO |
| 2026-02-06 | 1.1 | Alineacion con plan de refactor: ViewMode compartido, ownership MVU, fuentes de verdad de disponibilidad y cobertura i18n/a11y | Sarah (PO) |
| 2026-02-06 | 1.2 | Ajustes finales de arquitectura: fuente de verdad por tareas, routing `view=people`, roster de personas y refuerzo de tests/a11y | Winston (Architect) |
| 2026-02-06 | 1.3 | Validacion UX final: toolbar especifica, estados de datos, semantica accesible y mapping visual de disponibilidad | Sally (UX Expert) |

---

## Dev Agent Record

### Agent Model Used

openai/gpt-5.2-codex

### Debug Log References

- TBD

### Completion Notes List

- TBD

### File List

- TBD

---

## QA Results

### Review Date: TBD

### Reviewed By: TBD

### Gate Status

Gate: TBD
