# Story 7.2: Feedback visual al crear tarea en Pool

## Status

Done

## Story

**As a** miembro del proyecto,
**I want** ver claramente donde aparece una tarea recien creada,
**so that** no tenga que buscarla manualmente en el Pool.

## Problem Statement

Al crear una tarea, esta aparece en el Pool sin feedback visual. El usuario no sabe donde quedo ni si fue aplicada correctamente, generando friccion y dudas.

---

## Acceptance Criteria

1. Tras crear una tarea, esta se resalta con `highlight-info` durante 3–5s.
2. El resaltado usa el mismo patron reusable de la historia 7.1 (sin animaciones).
3. Si la tarea no es visible por filtros activos, se muestra un toast: “Tarea creada, pero no visible por filtros actuales” con accion “Limpiar filtros”.
4. Si la tarea es visible, se muestra un toast breve “Tarea creada” con accion “Ver”.
5. La accion “Ver” selecciona la tarea creada en Pool (equivalente al flujo de seleccion existente), sin scroll/centrado automatico.
6. Los toasts de este flujo reutilizan el componente/sistema global existente (sin variantes visuales ad hoc) y textos gestionados por i18n.
7. La accion del toast es accesible por teclado y anuncia el mensaje en region `aria-live` segun el patron UI existente.

---

## Tasks / Subtasks

- [x] **Task 0: Contrato tipado y ownership MVU** (AC: 1-5)
  - [x] 0.1 Definir mensajes tipados del flujo en `features/pool/msg.gleam` con convencion `Member*`: `MemberTaskCreatedFeedback(task_id: Int)` y `MemberHighlightExpired(task_id: Int)`.
  - [x] 0.2 Confirmar frontera de responsabilidad: creacion en `features/tasks/update.gleam`, highlight/render en `features/pool/*`.
  - [x] 0.3 Extender contrato de toast para soportar accion tipada (label + msg) y click handler.
  - [x] 0.4 Mantener consistencia visual: reutilizar estilos/markup del toast global sin clases nuevas especificas de Pool.
  - [x] 0.5 Enrutar copy via i18n (claves de locale), evitando strings hardcoded en `update`.

- [x] **Task 1: Reuso del patron de highlight** (AC: 1, 2)
  - [x] 1.1 Aplicar `is-highlight-source highlight-info` a la tarea creada.
  - [x] 1.2 Limpiar highlight al expirar el tiempo.

- [x] **Task 2: Feedback contextual** (AC: 3, 4)
  - [x] 2.1 Detectar si la tarea creada es visible bajo filtros actuales.
  - [x] 2.2 Mostrar toast con accion segun visibilidad.
  - [x] 2.3 Accion “Limpiar filtros” reutiliza handler existente.
  - [x] 2.4 Accion “Ver” reutiliza handler de seleccion de tarea existente.
  - [x] 2.5 Programar expiracion de highlight (3-5s) desde `update` con `schedule_timeout`, sin efectos en `view`.

- [x] **Task 3: Tests** (AC: 1-7)
  - [x] 3.1 Test de view: highlight aplicado a tarea creada.
  - [x] 3.2 Test de toast: mensaje correcto segun filtros.
  - [x] 3.3 Test de update: accion “Ver” selecciona la tarea creada.
  - [x] 3.4 Test de i18n: los textos del toast salen de claves de locale y no de literales en `update`.
  - [x] 3.5 Test de accesibilidad del toast: accion reachable por teclado + anuncio en `aria-live`.
  - [x] 3.6 Test de no-regresion: highlight de bloqueadores (7.1) se mantiene sin cambios al activar feedback de creacion.

---

## Dev Notes

### Archivos clave (frontend)

```
apps/client/src/scrumbringer_client/features/pool/update.gleam
apps/client/src/scrumbringer_client/features/pool/state.gleam
apps/client/src/scrumbringer_client/features/pool/msg.gleam
apps/client/src/scrumbringer_client/features/pool/view.gleam
apps/client/src/scrumbringer_client/features/tasks/update.gleam
apps/client/src/scrumbringer_client/ui/toast.gleam
apps/client/src/scrumbringer_client/styles.gleam
```

### UX Design

- Resaltado estatico (borde/halo), sin atenuar el resto.
- Toasts reutilizan el sistema global existente.
- El patron visual y de interaccion debe ser consistente con el resto de la interfaz (sin variantes locales en Pool).

### Precondicion de implementacion

- El patron reusable de highlight definido en 7.1 debe estar disponible en codigo (`is-highlight-source`, `is-highlight-target`, `is-highlight-dimmed` y variantes de intencion).
- Si 7.1 aun no esta mergeada, implementar 7.2 en la misma rama solo con cambios minimos estrictamente necesarios para mantener compatibilidad del patron.

### Contrato de interaccion (toast)

- **Toast visible (AC4):** “Tarea creada” + accion “Ver”.
- **Accion “Ver”:** selecciona la tarea recien creada usando el flujo de seleccion ya existente en Pool (sin scroll ni centrado automatico).
- **Toast no visible (AC3):** “Tarea creada, pero no visible por filtros actuales” + accion “Limpiar filtros”.

### Refactor Alignment (docs/architecture/refactor-plan-detailed.md)

- MVU por feature: efectos y estado en `features/pool/*`.
- Effects (timeout/undo) en `update`, nunca en `view`.
- Helpers de toast en `helpers/toast.gleam` o via `update_helpers` temporal.

### Type Notes (gleam-type-system)

- Mensajes tipados para el flujo (convencion feature): `MemberTaskCreatedFeedback(task_id: Int)` y `MemberHighlightExpired(task_id: Int)`.
- Extender `HighlightState` con variante dedicada para tarea recien creada (sin romper `BlockingHighlight`).
- Mantener pattern matching exhaustivo en `update` y `view` para todas las variantes de `HighlightState`.

---

## Testing

- Tests de vista y toast en `apps/client/test`.
- Cobertura AC explicita:
  - AC1/AC2: clase `is-highlight-source highlight-info` + limpieza por timeout.
  - AC3: toast de "no visible" + accion "Limpiar filtros" dispara handler existente.
  - AC4: toast "Tarea creada" + accion "Ver".
  - AC5: "Ver" equivale al flujo de seleccion existente (sin scroll/centrado).
  - AC6: toast reutiliza componente global + copy por i18n.
  - AC7: accion accesible por teclado + anuncio `aria-live`.
- Agregar test de no-regresion para comportamiento de highlight de 7.1 en paralelo al nuevo highlight de creacion.

### TDD (gleam-tdd-development)

- Definir firmas y ADTs primero.
- Escribir tests de update y view antes de implementar.

---

## Out of Scope

- Scroll automatico o centrado del canvas.
- Animaciones o pulsos.

---

## Change Log

| Fecha | Version | Descripcion | Autor |
|-------|---------|-------------|-------|
| 2026-02-05 | 1.0 | Historia creada para sprint 7 | UX/PO |
| 2026-02-06 | 1.1 | Historia aprobada, AC de accion "Ver" explicitado y precondicion de 7.1 documentada | Sarah (PO) |
| 2026-02-06 | 1.2 | Ajustes de validacion arquitectonica final: contrato tipado, ownership MVU, toast accionable y cobertura AC reforzada | Winston (Architect) |
| 2026-02-06 | 1.3 | Mejoras UX/reutilizacion: consistencia visual, i18n, accesibilidad de toast y no-regresion de 7.1 | Sally (UX Expert) |
| 2026-02-06 | 1.4 | Implementacion completa del feedback de creacion: toast accionable contextual, highlight temporal reusable y cobertura de tests ampliada | James (Dev) |

---

## Dev Agent Record

### Agent Model Used

openai/gpt-5.3-codex

### Debug Log References

- `gleam test` (apps/client)
- `make format`
- `make test`

### Completion Notes List

- Se completo el flujo de feedback al crear tarea con toast accionable tipado y enrute centralizado de acciones (`ViewTask` y `ClearPoolFilters`) en el update principal.
- Se implemento highlight de creacion (`CreatedHighlight`) reutilizando el patron visual de 7.1 y limpieza por expiracion con timeout desde `update`.
- Se encapsulo la decision de feedback (visible/no visible) en helper testeable, manteniendo copy por i18n para ambos locales.
- Se agregaron pruebas para feedback contextual, accesibilidad de toast (`aria-live` + accion visible), highlight de creacion y no-regresion del highlight de bloqueadores.
- Validacion completa ejecutada: `gleam test` de cliente, `make format` y `make test` (server + client + shared) en verde.

### File List

- `apps/client/src/scrumbringer_client/client_state.gleam`
- `apps/client/src/scrumbringer_client/client_state/member/pool.gleam`
- `apps/client/src/scrumbringer_client/client_update.gleam`
- `apps/client/src/scrumbringer_client/client_view.gleam`
- `apps/client/src/scrumbringer_client/features/pool/msg.gleam`
- `apps/client/src/scrumbringer_client/features/pool/update.gleam`
- `apps/client/src/scrumbringer_client/features/pool/view.gleam`
- `apps/client/src/scrumbringer_client/features/tasks/update.gleam`
- `apps/client/src/scrumbringer_client/helpers/toast.gleam`
- `apps/client/src/scrumbringer_client/i18n/en.gleam`
- `apps/client/src/scrumbringer_client/i18n/es.gleam`
- `apps/client/src/scrumbringer_client/i18n/text.gleam`
- `apps/client/src/scrumbringer_client/ui/toast.gleam`
- `apps/client/test/pool_highlight_update_test.gleam`
- `apps/client/test/pool_highlight_view_test.gleam`
- `apps/client/test/task_create_feedback_test.gleam`

---

## QA Results

### Review Date: 2026-02-06

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Implementacion solida y alineada al patron MVU existente: el flujo de feedback se integra sin introducir variantes visuales ad hoc, mantiene mensajes tipados para acciones de toast, y preserva el comportamiento previo del highlight de bloqueadores (7.1).

### Refactoring Performed

- No se realizaron cambios de codigo durante QA; revision de conformidad y evidencia sobre implementacion del dev.

### Acceptance Criteria Traceability

- AC1: `CreatedHighlight` + expiracion a 4000ms validado en update/view y pruebas de highlight.
- AC2: Reuso del patron existente (`is-highlight-source`, `highlight-info`) sin animaciones ni estilos nuevos por feature.
- AC3: Toast contextual para tarea no visible por filtros con accion tipada `ClearPoolFilters` y enrutado global.
- AC4: Toast contextual para tarea visible con accion tipada `ViewTask(task_id)`.
- AC5: Accion `ViewTask` reutiliza flujo existente de seleccion/detalle (`MemberTaskDetailsOpened`) sin logica de auto-scroll.
- AC6: Reuso del sistema global de toast (`ui/toast.gleam`, `helpers/toast.gleam`) y copy via i18n (`text/en/es`).
- AC7: Accion renderizada como `button` (teclado nativo) y anuncio con `role="status"` + `aria-live="polite"`.

### Compliance Check

- Coding Standards: ✓
- Project Structure: ✓
- Testing Strategy: ✓
- All ACs Met: ✓

### Test Evidence Reviewed

- `apps/client/test/task_create_feedback_test.gleam` (feedback visible/no visible, accion, aria-live)
- `apps/client/test/pool_highlight_update_test.gleam` (set/expire de `CreatedHighlight` + no-regresion con `BlockingHighlight`)
- `apps/client/test/pool_highlight_view_test.gleam` (clases visuales `highlight-info`)
- Ejecucion validada en QA: `gleam test` (client) y `make test` (server + client + shared), todo en verde.

### Top Issues

- No se identificaron issues bloqueantes ni de severidad media/alta.

### Gate Status

Gate: PASS → docs/qa/gates/7.2-task-create-feedback.yml

### Recommended Status

[✓ Ready for Done]
(Story owner decides final status)
