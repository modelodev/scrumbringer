# Story 7.2: Feedback visual al crear tarea en Pool

## Status

Approved

## Story

**As a** miembro del proyecto,
**I want** ver claramente donde aparece una tarea recien creada,
**so that** no tenga que buscarla manualmente en el Pool.

## Problem Statement

Al crear una tarea, esta aparece en el Pool sin feedback visual. El usuario no sabe donde quedo ni si fue aplicada correctamente, generando friccion y dudas.

---

## Acceptance Criteria

1. Tras crear una tarea, esta se resalta con `highlight-info` durante 3–5s.
2. El resaltado usa el mismo patron reusable de la historia 7.1 (sin animaciones).
3. Si la tarea no es visible por filtros activos, se muestra un toast: “Tarea creada, pero no visible por filtros actuales” con accion “Limpiar filtros”.
4. Si la tarea es visible, se muestra un toast breve “Tarea creada” con accion “Ver”.
5. La accion “Ver” selecciona la tarea creada en Pool (equivalente al flujo de seleccion existente), sin scroll/centrado automatico.
6. Los toasts de este flujo reutilizan el componente/sistema global existente (sin variantes visuales ad hoc) y textos gestionados por i18n.
7. La accion del toast es accesible por teclado y anuncia el mensaje en region `aria-live` segun el patron UI existente.

---

## Tasks / Subtasks

- [ ] **Task 0: Contrato tipado y ownership MVU** (AC: 1-5)
  - [ ] 0.1 Definir mensajes tipados del flujo en `features/pool/msg.gleam` con convencion `Member*`: `MemberTaskCreatedFeedback(task_id: Int)` y `MemberHighlightExpired(task_id: Int)`.
  - [ ] 0.2 Confirmar frontera de responsabilidad: creacion en `features/tasks/update.gleam`, highlight/render en `features/pool/*`.
  - [ ] 0.3 Extender contrato de toast para soportar accion tipada (label + msg) y click handler.
  - [ ] 0.4 Mantener consistencia visual: reutilizar estilos/markup del toast global sin clases nuevas especificas de Pool.
  - [ ] 0.5 Enrutar copy via i18n (claves de locale), evitando strings hardcoded en `update`.

- [ ] **Task 1: Reuso del patron de highlight** (AC: 1, 2)
  - [ ] 1.1 Aplicar `is-highlight-source highlight-info` a la tarea creada.
  - [ ] 1.2 Limpiar highlight al expirar el tiempo.

- [ ] **Task 2: Feedback contextual** (AC: 3, 4)
  - [ ] 2.1 Detectar si la tarea creada es visible bajo filtros actuales.
  - [ ] 2.2 Mostrar toast con accion segun visibilidad.
  - [ ] 2.3 Accion “Limpiar filtros” reutiliza handler existente.
  - [ ] 2.4 Accion “Ver” reutiliza handler de seleccion de tarea existente.
  - [ ] 2.5 Programar expiracion de highlight (3-5s) desde `update` con `schedule_timeout`, sin efectos en `view`.

- [ ] **Task 3: Tests** (AC: 1-7)
  - [ ] 3.1 Test de view: highlight aplicado a tarea creada.
  - [ ] 3.2 Test de toast: mensaje correcto segun filtros.
  - [ ] 3.3 Test de update: accion “Ver” selecciona la tarea creada.
  - [ ] 3.4 Test de i18n: los textos del toast salen de claves de locale y no de literales en `update`.
  - [ ] 3.5 Test de accesibilidad del toast: accion reachable por teclado + anuncio en `aria-live`.
  - [ ] 3.6 Test de no-regresion: highlight de bloqueadores (7.1) se mantiene sin cambios al activar feedback de creacion.

---

## Dev Notes

### Archivos clave (frontend)

```
apps/client/src/scrumbringer_client/features/pool/update.gleam
apps/client/src/scrumbringer_client/features/pool/state.gleam
apps/client/src/scrumbringer_client/features/pool/msg.gleam
apps/client/src/scrumbringer_client/features/pool/view.gleam
apps/client/src/scrumbringer_client/features/tasks/update.gleam
apps/client/src/scrumbringer_client/ui/toast.gleam
apps/client/src/scrumbringer_client/styles.gleam
```

### UX Design

- Resaltado estatico (borde/halo), sin atenuar el resto.
- Toasts reutilizan el sistema global existente.
- El patron visual y de interaccion debe ser consistente con el resto de la interfaz (sin variantes locales en Pool).

### Precondicion de implementacion

- El patron reusable de highlight definido en 7.1 debe estar disponible en codigo (`is-highlight-source`, `is-highlight-target`, `is-highlight-dimmed` y variantes de intencion).
- Si 7.1 aun no esta mergeada, implementar 7.2 en la misma rama solo con cambios minimos estrictamente necesarios para mantener compatibilidad del patron.

### Contrato de interaccion (toast)

- **Toast visible (AC4):** “Tarea creada” + accion “Ver”.
- **Accion “Ver”:** selecciona la tarea recien creada usando el flujo de seleccion ya existente en Pool (sin scroll ni centrado automatico).
- **Toast no visible (AC3):** “Tarea creada, pero no visible por filtros actuales” + accion “Limpiar filtros”.

### Refactor Alignment (docs/architecture/refactor-plan-detailed.md)

- MVU por feature: efectos y estado en `features/pool/*`.
- Effects (timeout/undo) en `update`, nunca en `view`.
- Helpers de toast en `helpers/toast.gleam` o via `update_helpers` temporal.

### Type Notes (gleam-type-system)

- Mensajes tipados para el flujo (convencion feature): `MemberTaskCreatedFeedback(task_id: Int)` y `MemberHighlightExpired(task_id: Int)`.
- Extender `HighlightState` con variante dedicada para tarea recien creada (sin romper `BlockingHighlight`).
- Mantener pattern matching exhaustivo en `update` y `view` para todas las variantes de `HighlightState`.

---

## Testing

- Tests de vista y toast en `apps/client/test`.
- Cobertura AC explicita:
  - AC1/AC2: clase `is-highlight-source highlight-info` + limpieza por timeout.
  - AC3: toast de "no visible" + accion "Limpiar filtros" dispara handler existente.
  - AC4: toast "Tarea creada" + accion "Ver".
  - AC5: "Ver" equivale al flujo de seleccion existente (sin scroll/centrado).
  - AC6: toast reutiliza componente global + copy por i18n.
  - AC7: accion accesible por teclado + anuncio `aria-live`.
- Agregar test de no-regresion para comportamiento de highlight de 7.1 en paralelo al nuevo highlight de creacion.

### TDD (gleam-tdd-development)

- Definir firmas y ADTs primero.
- Escribir tests de update y view antes de implementar.

---

## Out of Scope

- Scroll automatico o centrado del canvas.
- Animaciones o pulsos.

---

## Change Log

| Fecha | Version | Descripcion | Autor |
|-------|---------|-------------|-------|
| 2026-02-05 | 1.0 | Historia creada para sprint 7 | UX/PO |
| 2026-02-06 | 1.1 | Historia aprobada, AC de accion "Ver" explicitado y precondicion de 7.1 documentada | Sarah (PO) |
| 2026-02-06 | 1.2 | Ajustes de validacion arquitectonica final: contrato tipado, ownership MVU, toast accionable y cobertura AC reforzada | Winston (Architect) |
| 2026-02-06 | 1.3 | Mejoras UX/reutilizacion: consistencia visual, i18n, accesibilidad de toast y no-regresion de 7.1 | Sally (UX Expert) |

---

## Dev Agent Record

### Agent Model Used

openai/gpt-5.2-codex

### Debug Log References

- TBD

### Completion Notes List

- TBD

### File List

- TBD

---

## QA Results

### Review Date: TBD

### Reviewed By: TBD

### Gate Status

Gate: TBD
