# Story 4.13: Mejoras UX en Dialog de Tipo de Tarea

## Status

Ready

## Story

**As a** project manager,
**I want** un selector visual de iconos y preview en tiempo real al crear tipos de tarea,
**so that** puedo elegir el icono correcto sin adivinar nombres t√©cnicos y ver c√≥mo quedar√° antes de guardar.

## Prerequisites

- **Story 1.7** (Admin UI Management) - Completada
- **ref5-1** (CRUD Components) - Completada
- **icon_picker.gleam** - Componente ya existente
- **icon_catalog.gleam** - Cat√°logo de ~60 iconos disponible

## Problem Statement

El dialog actual de "Crear tipo de tarea" tiene deficiencias de usabilidad que dificultan la experiencia del usuario.

### Evidencia del Defecto

**Screenshot:** `capturas/uiux_crear_tipo_tarea.png`

| Problema | Severidad | Impacto |
|----------|-----------|---------|
| Selector de icono muestra texto t√©cnico (`clipboard-document-list`) | Alta | Usuario no puede visualizar iconos antes de seleccionar |
| No hay preview del resultado final | Media | Usuario debe adivinar c√≥mo se ver√° el tipo |
| Placeholder gen√©rico "Nombre del tipo" | Baja | No gu√≠a con ejemplos concretos |
| Sin feedback de l√≠mite de caracteres | Baja | Restricciones de input poco claras |

---

## Existing System Integration

### Componentes Reutilizables Identificados

| Componente | Archivo | Prop√≥sito |
|------------|---------|-----------|
| `icon_picker` | `ui/icon_picker.gleam` | Grid visual con b√∫squeda y filtro por categor√≠a |
| `icon_catalog` | `ui/icon_catalog.gleam` | ~60 iconos, `render()`, `search()`, `by_category()` |
| `text.truncate_with_info` | `utils/text.gleam` | Detectar si texto excede l√≠mite |
| Dialog patterns | `ui/dialog.gleam` | Estructura consistente de modales |
| Error states | CSS `.input-error` | Bordes rojos para validaci√≥n |

### Componente a Modificar

**Archivo:** `components/task_type_crud_dialog.gleam`

---

## Acceptance Criteria

### Funcionales ‚Äî Selector de Iconos

1. **AC1**: El selector de icono muestra un grid visual en lugar de dropdown de texto
2. **AC2**: El grid incluye campo de b√∫squeda para filtrar iconos por nombre
3. **AC3**: El grid tiene tabs para filtrar por categor√≠a (Tasks, Status, Objects, Actions)
4. **AC4**: Al hacer click en un icono, se selecciona y el picker se colapsa
5. **AC5**: El icono seleccionado se muestra claramente con estado visual activo

### Funcionales ‚Äî Preview en Tiempo Real

6. **AC6**: El dialog muestra una secci√≥n "Vista previa" arriba del formulario
7. **AC7**: La preview se actualiza en tiempo real al escribir el nombre
8. **AC8**: La preview se actualiza en tiempo real al seleccionar un icono
9. **AC9**: Cuando el nombre est√° vac√≠o, la preview muestra texto placeholder en estilo muted

### Funcionales ‚Äî Input con Contador

10. **AC10**: El campo nombre muestra contador de caracteres (ej: `12/30`)
11. **AC11**: El contador cambia a color warning cuando quedan ‚â§5 caracteres
12. **AC12**: El contador cambia a color error cuando se excede el l√≠mite
13. **AC13**: El placeholder muestra ejemplos concretos: "Ej: Bug, Historia, Mejora..."

### Accesibilidad

14. **AC14**: El grid de iconos es navegable con teclado (Tab, Enter, Arrow keys, Escape)
15. **AC15**: Cada icono tiene `aria-label` con su nombre legible
16. **AC16**: La preview tiene `aria-live="polite"` para anunciar cambios
17. **AC17**: El ratio de contraste del contador en estado error es ‚â•4.5:1

### Integraci√≥n

18. **AC18**: El modo Edit usa los mismos componentes mejorados
19. **AC19**: La funcionalidad existente (crear, editar, eliminar) sigue funcionando
20. **AC20**: i18n completo para nuevos textos en ES/EN

---

## UX Design (por Sally, UX Expert)

### Principio Aplicado

> **"Show, don't tell"** ‚Äî Los usuarios procesan informaci√≥n visual m√°s r√°pido que texto t√©cnico.

### Wireframe: Dialog Create Mode (Mejorado)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Crear tipo de tarea                    [‚úï] ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                             ‚îÇ
‚îÇ  Vista previa:                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  [üìã]  Bug de rendimiento           ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  Nombre *                           12/30   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Bug de rendimiento                  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  Icono                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ üîç Buscar icono...                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ [Tasks] [Status] [Objects] [Actions]‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îê     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îÇüìã‚îÇ ‚îÇüêõ‚îÇ ‚îÇ‚ú®‚îÇ ‚îÇüìå‚îÇ ‚îÇüîß‚îÇ ‚îÇüìÅ‚îÇ     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îò     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îê     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îÇ‚ö°‚îÇ ‚îÇüéØ‚îÇ ‚îÇüí°‚îÇ ‚îÇüîî‚îÇ ‚îÇüìä‚îÇ ‚îÇüè∑Ô∏è‚îÇ     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îò     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ            [Cancelar]  [Crear]              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Wireframe: Contador de Caracteres (Estados)

```
Estado Normal:        Estado Warning:       Estado Error:
Nombre *     5/30     Nombre *    26/30     Nombre *    35/30
                      (color warning)       (color error + borde)
```

### Wireframe: Preview (Estados)

```
Estado vac√≠o:                    Estado con datos:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [?] Nombre del tipo    ‚îÇ      ‚îÇ [üêõ] Bug cr√≠tico       ‚îÇ
‚îÇ     (texto muted)      ‚îÇ      ‚îÇ     (texto normal)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Technical Notes

### Archivos a Modificar

```
apps/client/src/scrumbringer_client/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ task_type_crud_dialog.gleam  ‚Üê MODIFICAR: integrar icon_picker, preview, contador
‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îî‚îÄ‚îÄ styles.gleam                 ‚Üê A√ëADIR: CSS para preview, contador
‚îú‚îÄ‚îÄ i18n/
‚îÇ   ‚îú‚îÄ‚îÄ text.gleam                   ‚Üê A√ëADIR: PreviewLabel, NameTooLong, ExamplePlaceholder
‚îÇ   ‚îú‚îÄ‚îÄ es.gleam                     ‚Üê A√ëADIR: traducciones ES
‚îÇ   ‚îî‚îÄ‚îÄ en.gleam                     ‚Üê A√ëADIR: traducciones EN
```

### Estado Actual del Dialog

**Archivo:** `components/task_type_crud_dialog.gleam`

**Model existente:**
```gleam
type Model {
  Model(
    mode: DialogMode,
    locale: Locale,
    // Create mode
    create_name: String,
    create_icon: String,
    create_in_flight: Bool,
    create_error: Option(String),
    // Edit mode
    edit_name: String,
    edit_icon: String,
    edit_in_flight: Bool,
    edit_error: Option(String),
    // ...
  )
}
```

**No requiere cambios al modelo** ‚Äî los campos `create_icon` y `edit_icon` ya existen.

### Nuevos Helpers a Crear

```gleam
// 1. Preview component
fn view_preview(icon_id: String, name: String, theme: Theme) -> Element(Msg)

// 2. Name input con contador
fn view_name_input_with_counter(
  name: String,
  max_len: Int,
  error: Option(String),
  locale: Locale,
  on_input: fn(String) -> Msg
) -> Element(Msg)

// 3. Helper para clase de contador
fn counter_class(current: Int, max: Int) -> String
```

### Integraci√≥n del Icon Picker

**Actual (a reemplazar):**
```gleam
// Dropdown de texto t√©cnico
html.select([...], [
  html.option([value("clipboard-document-list")], [text("clipboard-document-list")]),
])
```

**Propuesto (usar componente existente):**
```gleam
// Importar m√≥dulo
import scrumbringer_client/ui/icon_picker

// En la vista
icon_picker.view(
  model.create_icon,       // icono seleccionado
  UserSelectedCreateIcon   // mensaje al seleccionar
)
```

### Nuevas i18n Keys

```gleam
// En text.gleam
pub type Text {
  // ... existing
  PreviewLabel         // "Vista previa" / "Preview"
  NameTooLong          // "Nombre demasiado largo" / "Name too long"
  ExamplePlaceholder   // "Ej: Bug, Historia, Mejora..." / "E.g.: Bug, Story, Enhancement..."
}
```

### CSS a A√±adir

```css
/* Preview */
.task-type-preview {
  background: var(--sb-elevated);
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 16px;
}

.preview-content {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--sb-surface);
  border-radius: 6px;
  border: 1px solid var(--sb-border);
}

.preview-placeholder {
  color: var(--sb-muted);
  font-style: italic;
}

/* Character counter */
.form-group-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.char-counter {
  font-size: 12px;
  color: var(--sb-muted);
}

.char-counter.warning {
  color: var(--sb-warning);
}

.char-counter.over-limit {
  color: var(--sb-danger);
  font-weight: 500;
}
```

---

## Tasks / Subtasks

### Fase 1: Quick Wins (30 min)

- [ ] **T1**: Actualizar placeholder a "Ej: Bug, Historia, Mejora..."
- [ ] **T2**: A√±adir `maxlength` attribute al input de nombre
- [ ] **T3**: A√±adir i18n key `ExamplePlaceholder`

### Fase 2: Icon Picker (45 min)

- [ ] **T4**: Importar m√≥dulo `icon_picker` en task_type_crud_dialog
- [ ] **T5**: Reemplazar dropdown por `icon_picker.view()` en create mode
- [ ] **T6**: Reemplazar dropdown por `icon_picker.view()` en edit mode
- [ ] **T7**: Manejar mensaje `UserSelectedCreateIcon(String)`
- [ ] **T8**: Manejar mensaje `UserSelectedEditIcon(String)`
- [ ] **T9**: Verificar navegaci√≥n con teclado (AC14)

### Fase 3: Preview Component (30 min)

- [ ] **T10**: Crear helper `view_preview()`
- [ ] **T11**: A√±adir CSS para preview component
- [ ] **T12**: Integrar preview en create dialog (arriba del form)
- [ ] **T13**: Integrar preview en edit dialog
- [ ] **T14**: A√±adir `aria-live="polite"` para accesibilidad (AC16)
- [ ] **T15**: A√±adir i18n key `PreviewLabel`

### Fase 4: Character Counter (30 min)

- [ ] **T16**: Crear helper `view_name_input_with_counter()`
- [ ] **T17**: Crear helper `counter_class()`
- [ ] **T18**: A√±adir CSS para contador (normal, warning, error)
- [ ] **T19**: Integrar en create dialog
- [ ] **T20**: Integrar en edit dialog
- [ ] **T21**: A√±adir i18n key `NameTooLong`
- [ ] **T22**: Verificar contraste de colores (AC17)

### Fase 5: Testing & Polish (30 min)

- [ ] **T23**: Test manual: crear tipo de tarea con nuevo UI
- [ ] **T24**: Test manual: editar tipo de tarea con nuevo UI
- [ ] **T25**: Test manual: eliminar tipo de tarea (sin cambios esperados)
- [ ] **T26**: Test con screen reader (VoiceOver)
- [ ] **T27**: Verificar que no hay regresiones
- [ ] **T28**: Code review de accesibilidad

---

## Definition of Done

- [ ] El selector de iconos es visual (grid con b√∫squeda y categor√≠as)
- [ ] La preview se actualiza en tiempo real con icono y nombre
- [ ] El contador de caracteres funciona con estados normal/warning/error
- [ ] El placeholder muestra ejemplos concretos
- [ ] Navegaci√≥n por teclado funciona en el picker
- [ ] ARIA labels presentes en iconos y preview
- [ ] Edit mode usa los mismos componentes mejorados
- [ ] i18n completo ES/EN
- [ ] No hay regresiones en funcionalidad CRUD existente
- [ ] Tests existentes siguen pasando

---

## Risk Assessment

| Riesgo | Probabilidad | Impacto | Mitigaci√≥n |
|--------|--------------|---------|------------|
| Romper dialog existente | Baja | Alto | Cambios aditivos, no modifican flujo existente |
| icon_picker no se integra bien | Baja | Medio | Componente ya probado en otros contextos |
| Performance con muchos iconos | Muy baja | Bajo | icon_catalog usa lazy rendering |
| Accesibilidad insuficiente | Media | Medio | Tests con screen reader antes de merge |

**Rollback:** Revertir commit, funcionalidad anterior intacta.

---

## Estimated Effort

~2.5 horas de desarrollo enfocado (5 fases)

| Fase | Tiempo |
|------|--------|
| Quick Wins | 30 min |
| Icon Picker | 45 min |
| Preview | 30 min |
| Character Counter | 30 min |
| Testing | 30 min |

---

## Out of Scope

- Cambios al dialog de Delete (ya es adecuado)
- Nuevos iconos en el cat√°logo (usar existentes)
- Validaci√≥n de unicidad de nombre (backend ya lo hace)
- Animaciones de transici√≥n en el picker

---

## Technical Addendum: Correcciones de API (Revisi√≥n Arquitect√≥nica)

**Fecha:** 2026-01-26
**Autor:** Winston (Architect)
**Motivo:** Verificaci√≥n de API real vs. asumida en la especificaci√≥n original

### Hallazgo Principal

La secci√≥n "Technical Notes" original asume una API simplificada que **no coincide** con la implementaci√≥n real de `icon_picker.gleam`.

### API Real de `icon_picker.view()`

```gleam
/// Archivo: ui/icon_picker.gleam:40-45

pub fn view(
  search_query: String,              // Estado del campo de b√∫squeda
  active_category: String,           // Categor√≠a activa ("all", "tasks", etc.)
  selected_icon: String,             // ID del icono seleccionado
  on_msg: fn(IconPickerMsg) -> msg,  // Callback que envuelve mensajes
) -> Element(msg)

pub type IconPickerMsg {
  SearchChanged(String)    // Usuario escribi√≥ en b√∫squeda
  CategoryChanged(String)  // Usuario cambi√≥ de tab
  IconSelected(String)     // Usuario seleccion√≥ icono
}
```

### Cambios Requeridos en el Modelo

El modelo actual del dialog debe expandirse para almacenar el estado del picker:

```gleam
// ANTES (actual)
Model(
  create_icon: String,
  create_icon_open: Bool,
  edit_icon: String,
  edit_icon_open: Bool,
  // ...
)

// DESPU√âS (requerido)
Model(
  // Create mode - icon picker state
  create_icon: String,
  create_icon_search: String,     // NUEVO: query de b√∫squeda
  create_icon_category: String,   // NUEVO: categor√≠a activa

  // Edit mode - icon picker state
  edit_icon: String,
  edit_icon_search: String,       // NUEVO: query de b√∫squeda
  edit_icon_category: String,     // NUEVO: categor√≠a activa
  // ...
)
```

**Nota:** Los campos `*_icon_open: Bool` pueden eliminarse ya que el nuevo picker no usa collapse/expand.

### Nuevos Mensajes Requeridos

```gleam
pub type Msg {
  // ... existing ...

  // Create icon picker (NUEVOS)
  CreateIconSearchChanged(String)
  CreateIconCategoryChanged(String)
  CreateIconSelected(String)  // Renombrar de CreateIconChanged

  // Edit icon picker (NUEVOS)
  EditIconSearchChanged(String)
  EditIconCategoryChanged(String)
  EditIconSelected(String)    // Renombrar de EditIconChanged
}
```

### Handler de Integraci√≥n

```gleam
// Wrapper para convertir IconPickerMsg -> Msg (create mode)
fn wrap_create_icon_msg(picker_msg: icon_picker.IconPickerMsg) -> Msg {
  case picker_msg {
    icon_picker.SearchChanged(q) -> CreateIconSearchChanged(q)
    icon_picker.CategoryChanged(c) -> CreateIconCategoryChanged(c)
    icon_picker.IconSelected(id) -> CreateIconSelected(id)
  }
}

// Uso en la vista
icon_picker.view(
  model.create_icon_search,
  model.create_icon_category,
  model.create_icon,
  wrap_create_icon_msg,
)
```

### C√≥digo a Eliminar (DRY)

El dialog actual tiene una implementaci√≥n duplicada que debe eliminarse:

| L√≠neas | C√≥digo | Acci√≥n |
|--------|--------|--------|
| 774-779 | `const task_type_icons` | ELIMINAR |
| 781-824 | `fn view_icon_picker(...)` | ELIMINAR |

Este c√≥digo hardcodea 16 iconos y reimplementa funcionalidad que ya existe en `icon_picker.gleam` (60 iconos con b√∫squeda y categor√≠as).

### Valores Iniciales

```gleam
fn default_model() -> Model {
  Model(
    // ...
    create_icon: "clipboard-document-list",
    create_icon_search: "",           // NUEVO: b√∫squeda vac√≠a
    create_icon_category: "all",      // NUEVO: mostrar todos

    edit_icon: "clipboard-document-list",
    edit_icon_search: "",             // NUEVO
    edit_icon_category: "all",        // NUEVO
    // ...
  )
}
```

### Reset en Cambio de Modo

```gleam
fn handle_mode_received(model: Model, mode: DialogMode) -> #(Model, Effect(Msg)) {
  case mode {
    ModeCreate -> #(
      Model(
        ..model,
        mode: Some(ModeCreate),
        create_name: "",
        create_icon: "clipboard-document-list",
        create_icon_search: "",      // NUEVO: reset b√∫squeda
        create_icon_category: "all", // NUEVO: reset categor√≠a
        // ...
      ),
      effect.none(),
    )
    // Similar para ModeEdit...
  }
}
```

### Tareas T√©cnicas Adicionales

A√±adir a la lista de tareas:

- [ ] **T0**: A√±adir campos `create_icon_search`, `create_icon_category` al Model
- [ ] **T0.1**: A√±adir campos `edit_icon_search`, `edit_icon_category` al Model
- [ ] **T0.2**: Eliminar campos `create_icon_open`, `edit_icon_open` (obsoletos)
- [ ] **T0.3**: A√±adir mensajes `*IconSearchChanged`, `*IconCategoryChanged`
- [ ] **T0.4**: Crear wrappers `wrap_create_icon_msg`, `wrap_edit_icon_msg`
- [ ] **T0.5**: Eliminar `const task_type_icons` y `fn view_icon_picker`
- [ ] **T0.6**: Actualizar handlers en `update` para nuevos mensajes
- [ ] **T0.7**: Actualizar `handle_mode_received` con valores iniciales

### Impacto en Estimaci√≥n

| Fase Original | Ajuste |
|---------------|--------|
| Fase 2: Icon Picker (45 min) | **+30 min** por cambios de modelo y handlers |

**Nueva estimaci√≥n total:** ~3 horas (vs. 2.5 horas originales)

### Beneficio Arquitect√≥nico

Al usar `icon_picker.gleam` en lugar de la implementaci√≥n inline:

| M√©trica | Antes | Despu√©s |
|---------|-------|---------|
| Iconos disponibles | 16 | 60 |
| B√∫squeda | No | S√≠ |
| Categor√≠as | No | S√≠ (6 tabs) |
| L√≠neas de c√≥digo | +50 | -50 (reutiliza) |
| Mantenibilidad | Duplicado | Centralizado |

---

## References

- **Especificaci√≥n UX completa:** `docs/front-end-spec-task-type-dialog.md`
- **Screenshot del defecto:** `capturas/uiux_crear_tipo_tarea.png`
- **Icon Picker:** `apps/client/src/scrumbringer_client/ui/icon_picker.gleam`
- **Icon Catalog:** `apps/client/src/scrumbringer_client/ui/icon_catalog.gleam`
- **Dialog actual:** `apps/client/src/scrumbringer_client/components/task_type_crud_dialog.gleam`
