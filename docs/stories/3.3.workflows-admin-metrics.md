# Story 3.3: Métricas del motor de reglas v1 (validación del motor)

## Status: Draft

## Story
**As an** org admin (and project admin),
**I want** per-rule metrics and traceability,
**so that** we can validate the rules engine behavior and detect loops/suppression early.

## Acceptance Criteria
1. **Per-rule counters**: For each rule, the system exposes counts for `evaluated`, `applied`, and `suppressed`.
2. **Suppression reasons**: Suppressed events include a reason at minimum: `idempotent | not_user_triggered | not_matching | disabled`.
3. **Admin-only visibility**: Only org admins (and project admins for project-scoped rules) can access rule metrics.
4. **No leaderboards**: Rule metrics do not rank users; they focus on rule behavior.
5. **Admin UI**: A minimal admin panel lists rules with their counters and allows filtering by project and time window.

## Tasks / Subtasks
- [ ] Define rule metrics storage (table or materialized counters)
- [ ] Emit rule metrics events from engine pipeline
- [ ] Implement endpoints:
  - [ ] `GET /api/v1/org/workflows/metrics` (org admin)
  - [ ] `GET /api/v1/projects/:project_id/workflows/metrics` (project admin)
- [ ] Implement minimal admin UI view for metrics
- [ ] Tests:
  - [ ] Counters increment in expected scenarios
  - [ ] Authz

## Dev Notes
⚠️ **Planning stub / example**: This story is not fully refined.

- This story is mandatory as part of the rules engine DoD (no “engine without metrics”).

## Testing
- Server: `make test`
- Client: `apps/client: gleam test`

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 0.1 | Planning stub created | po |

## Dev Agent Record

## QA Results
