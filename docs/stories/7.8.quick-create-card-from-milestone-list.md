# Story 7.8: Creacion rapida de tarjeta desde fila de hito

## Status

Done

## Story

**As a** manager del proyecto,
**I want** crear una tarjeta directamente desde la fila de un hito en la vista Hitos,
**so that** pueda capturar trabajo sin abrir pasos intermedios y mantener el contexto del hito.

## Objetivo UX

- Reducir friccion entre planificacion por hitos y creacion de tarjetas.
- Mantener consistencia total con el flujo contextual ya validado en Story 7.6.
- No duplicar modales, estado ni rutas de creacion.

## Scope

**Incluye:**

1. CTA rapido `+ Tarjeta` en la fila del hito (tabla/lista de Hitos).
2. Wiring al flujo existente `MemberMilestoneCreateCardClicked(milestone_id)`.
3. Foco y accesibilidad del nuevo entrypoint.
4. Ajustes visuales menores para jerarquia del bloque de acciones (sin rediseÃ±o global).

**No incluye:**

1. Cambios backend para cards.
2. Nuevos modales de card create.
3. Nuevas rutas o estados paralelos.

## Acceptance Criteria

1. **AC1**: En la fila de cada hito visible para manager/admin se muestra CTA rapido `+ Tarjeta`.
2. **AC2**: Al hacer click en `+ Tarjeta` se abre `card-crud-dialog` en modo create contextual del hito correcto.
3. **AC3**: El dialog muestra contexto read-only de hito destino (`MilestoneTarget`) igual que Story 7.6.
4. **AC4**: No se introduce modal/estado/ruta duplicada; se reutiliza el flujo existente de 7.6.
5. **AC5**: En mobile (viewport reducido) el entrypoint sigue disponible (CTA visible o accion equivalente en menu de acciones de fila).
6. **AC6**: Al cerrar/cancelar el dialog abierto desde el CTA rapido, el foco vuelve a un elemento persistente de la misma fila de hito.
7. **AC7**: i18n ES/EN completo para nuevo CTA y cualquier texto nuevo asociado.
8. **AC8**: El estilo del CTA rapido respeta semantica visual (primaria/secundaria) y no introduce variantes ad hoc.
9. **AC9**: Regression: los entrypoints existentes (`+ Nueva tarjeta en este hito` en detalle + create card no contextual) siguen funcionando sin cambios de comportamiento.
10. **AC10**: Existen pruebas deterministas de render, wiring contextual, foco de cierre y regresion.
11. **AC11**: El CTA rapido reutiliza el layout/clases existentes del bloque de acciones de fila de hito (mismo patron de botoneria), sin crear una variante CSS nueva para esta accion.

## Reutilizacion y Arquitectura

1. Reusar `features/milestones/view.gleam` para punto de entrada UI.
2. Reusar `features/pool/msg.gleam` y `features/pool/update.gleam` para routing de mensajes.
3. Reusar `features/admin/cards.gleam` + `components/card_crud_dialog.gleam` para apertura/cierre/create.
4. Reusar `features/milestones/ids.gleam` para ids estables de foco y pruebas.
5. Reusar i18n central (`i18n/text.gleam`, `i18n/es.gleam`, `i18n/en.gleam`).

## Tasks / Subtasks

- [x] **Task 1 (AC: 1, 5, 8, 11): Entry point rapido en lista de hitos**
  - [x] 1.1 Agregar CTA `+ Tarjeta` por fila de hito para roles permitidos.
  - [x] 1.2 Definir comportamiento responsive: conservar CTA o moverlo a `Acciones` en mobile.
  - [x] 1.3 Ajustar jerarquia visual del bloque de acciones sin crear estilos ad hoc.
  - [x] 1.4 Reusar clases/patron de botoneria ya existentes en acciones de fila; evitar crear clase dedicada nueva para `+ Tarjeta`.

- [x] **Task 2 (AC: 2, 3, 4): Wiring contextual reutilizando 7.6**
  - [x] 2.1 Conectar CTA rapido a `MemberMilestoneCreateCardClicked(milestone_id)`.
  - [x] 2.2 Verificar que el dialog abre con `milestone-id`/`milestone-name` correctos.
  - [x] 2.3 Confirmar que no hay ramas de estado/modal duplicadas.

- [x] **Task 3 (AC: 6): Accesibilidad y foco**
  - [x] 3.1 Asignar id estable al trigger rapido o elemento persistente de retorno.
  - [x] 3.2 Garantizar retorno de foco al cerrar/cancelar dialog contextual.
  - [x] 3.3 Validar navegacion por teclado en flujo completo.

- [x] **Task 4 (AC: 7, 9): i18n y regresion funcional**
  - [x] 4.1 Agregar clave ES/EN para CTA rapido.
  - [x] 4.2 Validar que 7.6 (detalle de hito) no se rompe.
  - [x] 4.3 Validar create card global no contextual sin regresion.

- [x] **Task 5 (AC: 10): Testing determinista**
  - [x] 5.1 Test de render CTA rapido por fila (desktop/mobile strategy).
  - [x] 5.2 Test de click CTA -> apertura contextual con milestone id correcto.
  - [x] 5.3 Test de cierre/cancelacion -> foco retorna a origen esperado.
  - [x] 5.4 Test de regresion para flujo de 7.6 y create no contextual.

## Testing Notes

- Cliente:
  - `gleam format`
  - `gleam check`
  - `gleam test`
- Cobertura minima:
  - `apps/client/test/milestones_view_test.gleam`
  - `apps/client/test/milestones_update_test.gleam`
  - tests existentes de `card_crud_dialog`/admin cards para regresion.

## Definition of Done

- Creacion contextual de tarjeta disponible directamente desde fila de hito.
- Reutilizacion completa de arquitectura/flujo existente (sin duplicaciones).
- UX consistente en desktop y mobile.
- i18n ES/EN completo.
- Accesibilidad de foco verificada.
- Tests deterministas y regresiones en verde.

## Change Log

| Date       | Version | Description                                                      | Author |
| ---------- | ------- | ---------------------------------------------------------------- | ------ |
| 2026-02-08 | 0.1     | Story creada desde analisis UX posterior a 7.6                  | UX     |
| 2026-02-08 | 1.0     | Implementacion quick create card desde fila de hito             | James  |
| 2026-02-08 | 1.1     | Cierre de historia tras limpieza final y validacion completa    | Quinn  |

## Dev Agent Record

### Agent Model Used

openai/gpt-5.3-codex

### Debug Log References

- `gleam format` (apps/client)
- `gleam check` (apps/client)
- `gleam test` (apps/client)

### Completion Notes List

- Se agrego CTA rapido `+ Tarjeta` por fila de hito en bloque de acciones existente.
- El CTA rapido reutiliza el flujo contextual existente (`MemberMilestoneCreateCardClicked`) y abre `card-crud-dialog` con contexto de hito.
- Se agrego id estable para trigger rapido y se reutilizo en retorno de foco al cerrar/cancelar dialog contextual.
- Se agregaron claves i18n ES/EN para CTA rapido (`QuickCard`) sin introducir textos hardcodeados.
- Se ajustaron pruebas de vista/update para cubrir render del CTA rapido y foco de cierre contextual.

### File List

- `apps/client/src/scrumbringer_client/features/milestones/view.gleam`
- `apps/client/src/scrumbringer_client/features/milestones/ids.gleam`
- `apps/client/src/scrumbringer_client/features/pool/update.gleam`
- `apps/client/src/scrumbringer_client/i18n/text.gleam`
- `apps/client/src/scrumbringer_client/i18n/en.gleam`
- `apps/client/src/scrumbringer_client/i18n/es.gleam`
- `apps/client/test/milestones_view_test.gleam`
- `apps/client/test/milestones_update_test.gleam`

## QA Results

_Pending QA review._
