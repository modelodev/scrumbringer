# Story 5.8: Quickfix UX - Tipos de tarea

## Status

Done

## Story

**As a** admin de proyecto,
**I want** que la lista y el formulario de tipos de tarea muestren informacion clara y legible,
**so that** pueda crear, editar y entender tipos de tarea sin ambiguedades ni ruido visual.

## Problem Statement

En la vista "Tipos de tarea" se observan defectos de usabilidad que generan confusion:

- La columna **Capacidad** muestra el id en lugar del nombre.
- El selector de icono muestra el nombre tecnico del icono, aunque el icono ya se ve.
- Las acciones solo muestran iconos sin un texto/tooltip evidente.
- Las columnas numericas no tienen alineacion consistente para lectura rapida.
- El CTA "Crear" no es especifico y el modal no diferencia campos obligatorios vs opcionales.

## Objetivos

1. Mostrar la capacidad por nombre en tabla y estados sin capacidad como "Ninguna".
2. Simplificar el selector de icono para reducir ruido visual.
3. Mejorar la claridad de acciones con tooltips/aria y mejor espaciado.
4. Alinear columnas numericas para scan rapido.
5. Refinar microcopy del CTA de creacion.

---

## UX Quickfix (resumen)

- Tabla: Capacidad usa nombre legible y no id.
- Selector de icono: solo iconos (o label humano corto), sin slug tecnico.
- Acciones: tooltip/aria + padding derecho consistente.
- Columnas numericas: alineacion uniforme.
- CTA: "Crear tipo" en lugar de "Crear".

---

## Acceptance Criteria

1. La columna **Capacidad** muestra el nombre de la capacidad (no id) y usa "Ninguna" cuando no aplica.
2. La tabla no expone ids en ninguna columna visible al usuario final.
3. El selector de icono no muestra el slug tecnico del icono; solo icono y, si hay texto, es humano.
4. Las acciones de editar/eliminar tienen tooltip y aria-label legibles.
5. La columna **Tareas** y cualquier columna numerica usan alineacion consistente.
6. El boton primario del modal de creacion muestra "Crear tipo".
7. El formulario distingue visualmente campos opcionales sin cambiar el comportamiento actual.

---

## Tasks / Subtasks

- [x] **Task 1: Tabla de tipos de tarea (Capacidad legible)** (AC: 1, 2, 5)
  - [x] 1.1 Resolver nombre de capacidad desde la lista de capabilities disponible en el modelo y centralizarlo en helper reutilizable (evitar logica inline duplicada).
  - [x] 1.2 Mostrar "Ninguna" cuando no hay capacidad asignada.
  - [x] 1.3 Aplicar clase de columna numerica a **Tareas** y otras columnas numericas.

- [x] **Task 2: Selector de icono sin slug tecnico** (AC: 3)
  - [x] 2.1 Remover el texto tecnico en el trigger del icon picker y reutilizar etiqueta humana si existe catalogo/lookup.
  - [x] 2.2 Mantener accesibilidad con title/aria-label en el trigger.

- [x] **Task 3: Acciones con tooltips y espaciado** (AC: 4)
  - [x] 3.1 Asegurar tooltip/aria-label en botones de editar/eliminar.
  - [x] 3.2 Ajustar padding/alineacion del area de acciones si es necesario.

- [x] **Task 4: Microcopy del CTA** (AC: 6, 7)
  - [x] 4.1 Actualizar i18n para "Crear tipo" (ES/EN) y usarlo en el boton primario.
  - [x] 4.2 Marcar seccion "Opcional" para el selector de capacidad.

- [x] **Task 5: Tests**
  - [x] 5.1 Test de render: columna Capacidad muestra nombre y no id.
  - [x] 5.2 Test de render: icon picker no muestra slug tecnico.

---

## Dev Notes

### Fuentes de arquitectura usadas

- `docs/architecture/coding-standards.md`
- `docs/architecture/source-tree.md`

### UI components y patrones

- Usar componentes existentes en `ui/` (section_header, data_table, dialog, icons, badge). [Source: docs/architecture/coding-standards.md#L231]
- Usar `data_table` para tablas con datos remotos. [Source: docs/architecture/coding-standards.md#L256]
- Para iconos en botones, usar `icons.nav_icon()` y proporcionar `title` y `aria-label`. [Source: docs/architecture/coding-standards.md#L278]
- Mantener DRY: extraer helper para resolver nombre de capacidad y reusar lookup/labels del catalogo de iconos (no duplicar mapeos en views).

### Source tree

- La UI cliente vive en `apps/client/src/` y sus tests en `apps/client/test/`. [Source: docs/architecture/source-tree.md#L58]

---

## Testing

### Test Standards

- Tests en `apps/client/test/`. [Source: docs/architecture/source-tree.md#L58]

### Test Cases

1. **Capacidad legible**: La tabla muestra nombre de capacidad y "Ninguna" si no hay.
2. **Icon picker**: El trigger no muestra slug tecnico del icono.

---

## Change Log

| Fecha | Version | Descripcion | Autor |
|-------|---------|-------------|-------|
| 2026-01-27 | 1.0 | Historia inicial creada desde feedback UX | OpenCode |
| 2026-01-27 | 1.1 | Ajustes DRY/calidad + estado Approved | OpenCode |
| 2026-01-27 | 1.2 | Implementacion UI + tests y status Review | OpenCode |
| 2026-01-27 | 1.3 | Tests adicionales + ajustes visuales (alineacion/padding) | OpenCode |

---

## Dev Agent Record

### Agent Model Used

openai/gpt-5.2-codex

### Debug Log References

- apps/client: `gleam test`

### Completion Notes List

- Tabla de tipos ahora resuelve nombre de capacidad y evita ids visibles.
- Icon picker oculta slug tecnico y usa labels humanos para aria/title.
- CTA actualizado a "Crear tipo" y campo opcional con estilo diferenciado.
- Tests agregados para capacidad legible, NoneOption, clases numericas y aria labels.
- Ajuste visual: columnas numericas alineadas a la derecha y padding en acciones.

### File List

- apps/client/src/scrumbringer_client/features/admin/view.gleam
- apps/client/src/scrumbringer_client/components/task_type_crud_dialog.gleam
- apps/client/src/scrumbringer_client/styles.gleam
- apps/client/src/scrumbringer_client/i18n/es.gleam
- apps/client/src/scrumbringer_client/i18n/en.gleam
- apps/client/test/admin_task_types_view_test.gleam

---

## QA Results

### Review Date: 2026-01-27

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Implementation aligns with the UX quickfix scope. Capability name resolution, icon trigger labels, CTA copy, and optional field styling are clear and localized. Helper extraction keeps view logic readable and follows existing patterns.

### Refactoring Performed

- None.

### Requirements Traceability

- AC1 covered by `apps/client/test/admin_task_types_view_test.gleam` (capability name, no id rendering).
- AC3 covered by `apps/client/test/admin_task_types_view_test.gleam` (icon trigger hides slug).
- AC2, AC4, AC5, AC6, AC7 verified by code review only; no automated tests found.

### Test Architecture Assessment

- Unit render tests exist for two ACs; no integration/e2e coverage for actions tooltips, numeric alignment, CTA copy, or optional field styling.

### NFR Assessment

- Security: PASS (UI-only changes, no auth/data handling changes observed).
- Performance: PASS (render-only adjustments).
- Reliability: PASS (no stateful logic changes).
- Maintainability: CONCERNS (several ACs rely on manual verification).

### Testability Evaluation

- UI is testable via render string assertions and data-testid hooks. Consider adding explicit tests for CTA copy and tooltip/aria attributes.

### Standards Compliance

- Coding Standards: ✓ Uses `data_table`, `action_buttons`, and `icon_catalog` patterns.
- Project Structure: ✓ Files reside under `apps/client/src` and `apps/client/test`.
- Testing Strategy: ⚠️ Partial coverage; missing tests for AC2/4/5/6/7.
- All ACs Met: ✓ By code inspection; coverage gaps remain.

### Improvements Checklist

- [ ] Add unit test for AC4 (edit/delete tooltip + aria-label).
- [ ] Add unit test for AC5 (numeric alignment class for tasks column).
- [ ] Add unit test for AC6 (primary CTA copy "Crear tipo").
- [ ] Add unit test for AC7 (optional capability section styling/label).
- [ ] Add unit test to assert no id leakage in task types table (AC2).

### Security Review

- No security concerns identified for this UI-only change set.

### Performance Considerations

- No performance risks observed.

### Files Modified During Review

- None.

### Gate Status

Gate: CONCERNS → docs/qa/gates/5.8-task-type-ux-quickfix.yml

### Recommended Status

[✗ Changes Required - See unchecked items above]

### Review Date: 2026-01-27

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

UX updates remain consistent with the quickfix scope. Capability name resolution, icon picker trigger labels, and numeric alignment are clear and localized. The optional capability label and CTA copy are correct by code inspection.

### Refactoring Performed

- None.

### Requirements Traceability

- AC1 covered by `apps/client/test/admin_task_types_view_test.gleam` (capability name + None option).
- AC3 covered by `apps/client/test/admin_task_types_view_test.gleam` (icon picker hides slug).
- AC4 covered by `apps/client/test/admin_task_types_view_test.gleam` (edit/delete aria-labels).
- AC5 covered by `apps/client/test/admin_task_types_view_test.gleam` (numeric alignment class).
- AC2, AC6, AC7 verified by code review only; no automated tests found.

### Test Architecture Assessment

- Render tests now cover 4 ACs; remaining gaps are CTA copy, optional field styling/label, and explicit no-id visibility checks.

### NFR Assessment

- Security: PASS (UI-only changes, no auth/data handling changes observed).
- Performance: PASS (render-only adjustments).
- Reliability: PASS (no stateful logic changes).
- Maintainability: CONCERNS (AC2/6/7 still manual-only).

### Testability Evaluation

- Add render assertions for the create CTA label and optional field class/label; add a guard assertion that no task type ids are rendered in visible cells.

### Standards Compliance

- Coding Standards: ✓ Uses existing data_table + action_buttons patterns and i18n keys.
- Project Structure: ✓ Files remain under `apps/client/src` and `apps/client/test`.
- Testing Strategy: ⚠️ Partial coverage; AC2/6/7 remain untested.
- All ACs Met: ✓ By code inspection; coverage gaps remain.

### Improvements Checklist

- [ ] Add unit/render test for AC2 (no id leakage in visible cells).
- [ ] Add unit/render test for AC6 (primary CTA copy "Crear tipo").
- [ ] Add unit/render test for AC7 (optional capability label/styling).

### Security Review

- No security concerns identified for this UI-only change set.

### Performance Considerations

- No performance risks observed.

### Files Modified During Review

- None.

### Gate Status

Gate: CONCERNS → docs/qa/gates/5.8-task-type-ux-quickfix.yml

### Recommended Status

[✗ Changes Required - See unchecked items above]
